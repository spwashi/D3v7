(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const Ur="spwashi-datum-";function Ii(t){return Ur+t%13}function zi(t){document.body.dataset.dataindex=t,window.spwashi.onDataIndexChange(t)}function kt(){return parseInt((document.body.dataset.dataindex||"0").split("-").reverse()[0])}const Di=()=>window.spwashi.parameters.mode,K=(t,e=!0,n=!1)=>{e&&Di()===t&&(t=null),window.spwashi.parameters.mode=t,document.body.dataset.mode=t,window.spwashi.onModeChange(t,n)};function Kr(t){const e=document.querySelector("#mainmenu-shortcuts ol");if(!e){window.spwashi.callbacks.acknowledgeLonging("wondering about menu");return}e.innerHTML="",window.spwashi.modeOrder.forEach(n=>{const i=document.createElement("li");i.dataset.modeAction=n,i.dataset.interfaceElement="main-menu";const r=document.createElement("button");r.id=`mode-selector--${n}`,r.innerText=n,i.appendChild(r),e.appendChild(i)}),window.spwashi.modeOrder.forEach(n=>{const i=document.querySelector(`#mode-selector--${n}`);i.onclick=()=>{K(Di()===n?null:n)}}),K(t)}function jr(){window.spwashi.parameters=window.spwashi.parameters||{},window.spwashi.parameters.debug=!1,window.spwashi.parameters.perspective=window.spwashi.parameters.perspective||void 0,window.spwashi.parameters.dataIndex=window.spwashi.parameters.dataIndex||null,window.spwashi.parameters.width=window.spwashi.parameters.width||window.innerWidth*.9,window.spwashi.parameters.height=window.spwashi.parameters.height||window.innerHeight*.9,window.spwashi.parameters.startPos=window.spwashi.parameters.startPos||{},window.spwashi.parameters.startPos.x=window.spwashi.parameters.startPos.x||window.spwashi.parameters.width/2,window.spwashi.parameters.startPos.y=window.spwashi.parameters.startPos.y||window.spwashi.parameters.height/2,window.spwashi.parameters.links=window.spwashi.parameters.links||{},window.spwashi.parameters.links.strength=window.spwashi.parameters.links.strength||.1,window.spwashi.parameters.nodes=window.spwashi.parameters.nodes||{},window.spwashi.parameters.nodes.count=window.spwashi.parameters.nodes.count||13,window.spwashi.parameters.nodes.radiusMultiplier=window.spwashi.parameters.nodes.radiusMultiplier||30,window.spwashi.parameters.forces=window.spwashi.parameters.forces||{},window.spwashi.parameters.forces.alpha=window.spwashi.parameters.forces.alpha||1,window.spwashi.parameters.forces.alphaTarget=window.spwashi.parameters.forces.alphaTarget||.3,window.spwashi.parameters.forces.alphaDecay=window.spwashi.parameters.forces.alphaDecay||.03,window.spwashi.parameters.forces.velocityDecay=window.spwashi.parameters.forces.velocityDecay||.91,window.spwashi.parameters.forces.charge=window.spwashi.parameters.forces.charge||10,window.spwashi.parameters.forces.centerStrength=window.spwashi.parameters.forces.centerStrength||1,window.spwashi.parameters.forces.boundingBox=typeof window.spwashi.parameters.forces.boundingBox<"u"?window.spwashi.parameters.forces.boundingBox:!0,window.spwashi.parameters.forces.centerPos=window.spwashi.parameters.forces.centerPos||{},window.spwashi.parameters.forces.centerPos.x=window.spwashi.parameters.forces.centerPos.x||window.spwashi.parameters.startPos.x,window.spwashi.parameters.forces.centerPos.y=window.spwashi.parameters.forces.centerPos.y||window.spwashi.parameters.startPos.y}function Qt(t){var i;[...t.entries()].forEach(([r,o])=>(document.querySelector(`[name=${r}]`)||{}).value=o),window.spwashi.parameters=window.spwashi.parameters||{},window.spwashi.values=window.spwashi.values||{},window.spwashi.values.fy=[],window.spwashi.values.r=[],window.spwashi.values.text=window.spwashi.values.text||{},window.spwashi.values.text.fontSize=window.spwashi.values.text.fontSize||[],window.spwashi.superpower=window.spwashi.superpower||{name:"hyperlink",intent:1},window.spwashi.parameters.links=window.spwashi.parameters.links||{},window.spwashi.parameters.forces=window.spwashi.parameters.forces||{},window.spwashi.featuredIdentity=((i=/\/identity\/([a-zA-Z\d]+)/.exec(window.location.href))==null?void 0:i[1])||t.get("identity");const e=`spwashi.parameters#${window.spwashi.featuredIdentity}`;window.spwashi.parameterKey=e,console.log({parameterKey:e});let n;if(t.get("title")&&(document.title=t.get("title"),document.querySelector("h1").innerText=t.get("title")),t.has("perspective")&&(window.spwashi.parameters.perspective=t.get("perspective")!=="0"),t.has("display")&&(document.body.dataset.displaymode=t.get("display")),t.has("reset")&&window.localStorage.clear(),t.has("nodeCount")&&(window.spwashi.parameters.nodes=window.spwashi.parameters.nodes||{},window.spwashi.parameters.nodes.count=+t.get("nodeCount")),t.has("linkStrength")&&(window.spwashi.parameters.links.strength=+t.get("linkStrength")),t.has("charge")&&(window.spwashi.parameters.forces.charge=+t.get("charge")),t.has("linkStyle")?window.spwashi.parameters.links.linkPrev=t.get("linkStyle")==="prev":window.spwashi.parameters.links.linkPrev=0,t.has("width")&&(window.spwashi.parameters.width=+t.get("width")),t.has("size")&&(window.spwashi.parameters.width=+t.get("size").split(",")[0],window.spwashi.parameters.height=+t.get("size").split(",")[0]),t.has("height")&&(window.spwashi.parameters.height=+t.get("height")),t.has("centerStrength"),t.has("center")){let[r,o]=t.get("center").split(",").map(s=>+s);o=o||r,window.spwashi.parameters.startPos={x:r,y:o},window.spwashi.parameters.forces.centerPos={x:r,y:o}}else{let[r,o]=[window.spwashi.parameters.width,window.spwashi.parameters.height].map(s=>s/2);window.spwashi.parameters.startPos={x:r,y:o},window.spwashi.parameters.forces.centerPos={x:r,y:o}}t.has("alpha")&&(window.spwashi.parameters.forces.alpha=+t.get("alpha")),t.has("alphaTarget")&&(window.spwashi.parameters.forces.alphaTarget=+t.get("alphaTarget")),t.has("alphaDecay")&&(window.spwashi.parameters.forces.alphaDecay=+t.get("alphaDecay")),t.has("velocityDecay")&&(window.spwashi.parameters.forces.velocityDecay=+t.get("velocityDecay")),t.has("zoom")?window.spwashi.parameters.canzoom=!!+t.get("zoom"):window.spwashi.parameters.canzoom=!0,t.has("superpower")&&(window.spwashi.superpower.name=t.get("superpower")),t.has("intent")&&(window.spwashi.superpower.intent=parseInt(t.get("intent")||1)),t.has("mode")&&(n=t.get("mode"),setTimeout(()=>K(n,!1),500)),t.has("fx")&&(window.spwashi.values.fx=t.get("fx").split(",").map(r=>+r)),t.has("fy")&&(window.spwashi.values.fy=t.get("fy").split(",").map(r=>+r)),t.has("r")&&(window.spwashi.values.r=t.get("r").split(",").map(r=>+r)),t.has("defaultRadius")&&(window.spwashi.parameters.nodes.radiusMultiplier=+t.get("defaultRadius")),t.has("fontSize")&&(window.spwashi.values.text.fontSize=t.get("fontSize").split(",").map(r=>+r)),t.has("doFetch")&&(window.spwashi.doFetchNodes=t.get("dofetch")==="1"),t.has("boundingBox")&&(window.spwashi.parameters.forces.boundingBox=t.get("boundingBox")==="1"),t.has("dataindex")&&(window.spwashi.parameters.dataIndex=+t.get("dataindex"),zi(Ii(window.spwashi.parameters.dataIndex))),t.has("debug")&&(window.spwashi.parameters.debug=!0,document.body.dataset.debug="debug"),window.spwashi.initialMode=n}let Z;const gt={ready:!0},et={x:0,y:0,queuedAction:()=>{const t=window.spwashi.getItem("mode","focal.root");K(t)},onFocus:()=>{}};function Ln(t,e=500){t.classList.add("consent-to-engage");const n={interested:null,revoke:r},i=setTimeout(()=>{t.classList.remove("consent-to-engage"),t.classList.add("consented-to-engage"),n.interested=!0},e);function r(){clearTimeout(i),t.classList.remove("consented-to-engage"),t.classList.remove("consent-to-engage"),n.interested=!1}return n}function Oe(){if(!Z){if(Z=document.querySelector("#focal-square"),!Z)return;const t=window.spwashi.getItem("focalPoint","focal.root");t&&(Object.assign(et,t),Ut(et,!0)),Z.onmousedown=e=>{e.preventDefault();const n=Ln(Z,100);document.documentElement.onmousemove=i=>{n.interested&&(i.preventDefault(),gt.ready=!1,Ut({x:i.x,y:i.y},!0))},document.documentElement.onmouseup=i=>{i.preventDefault(),n.revoke(),gt.ready||setTimeout(()=>gt.ready=!0,100),document.documentElement.onmousemove=null,document.documentElement.onmouseup=null}},Z.ontouchstart=e=>{e.preventDefault();const n=Ln(Z,300);document.documentElement.ontouchmove=i=>{i.preventDefault(),n.interested&&(gt.ready=!1,Ut({x:i.touches[0].clientX,y:i.touches[0].clientY},!0))},document.documentElement.ontouchend=i=>{i.preventDefault(),n.interested||(gt.ready=!0,Z.onclick(i)),n.revoke(),gt.ready||setTimeout(()=>gt.ready=!0,100),document.documentElement.ontouchmove=null,document.documentElement.ontouchend=null}}}return Z.onclick=t=>{gt.ready&&et.queuedAction()},Z.onfocus=t=>{et.onFocus()},Z}function Ut({x:t,y:e},n=!1){et.x=t,et.y=e,n&&(et.fx=t,et.fy=e),document.documentElement.style.setProperty("--focal-x",t+"px"),document.documentElement.style.setProperty("--focal-y",e+"px"),window.spwashi.setItem("focalPoint",{x:t,y:e,fx:t,fy:e},"focal.root")}document.documentElement.style.setProperty("--focal-y-basis",document.documentElement.getBoundingClientRect().height+"px");function Vr(t){const e=t.getBoundingClientRect().x,n=t.getBoundingClientRect().y,i=t.getBoundingClientRect().width,r=t.getBoundingClientRect().height,o=e+i,s=n+r;(et.fx===void 0||et.fy===void 0)&&Ut({x:o,y:s})}function Wr(t){const e=new Image;return e.src=t,window.spwashi.setItem("parameters.page-image.url",t),e}function hn(){const t=document.querySelector("#main-image-container");if(!t){window.spwashi.callbacks.acknowledgeLonging("wondering about main image container");return}t.innerHTML="";const e=window.spwashi.getItem("parameters.page-image.url");if(e){const n=new Image;n.src=e,t.appendChild(n)}}function j(...t){window.spwashi.nodes.push(...t)}function Oi(t){return window.spwashi.nodes.map(t)}function H(t){window.spwashi.nodes.forEach(t)}const Gr=["thoughts are nodes","text can be linked"];function $i(t){j(...[{id:"help--home",name:"home",description:"go to home page",r:30,url:"/"}].map(n=>(n.fy=t,n))),window.spwashi.reinit()}function Jr(t){{window.spwashi.setItem("help",Gr.join(`
`),"focal.root"),j({fx:window.spwashi.parameters.startPos.x,fy:window.spwashi.parameters.startPos.y,id:"help",name:"help",kind:"__help",r:30,collisionRadius:100,charge:-100,url:"/help",callbacks:{click(e,n){n.fx=n.fy=void 0;const i=n.y;n.x,$i(i)}}}),t.physicsChange=!0;return}}function Qr(){window.location.href="/"}function Zr(t){{t.valueStrings.push("add=10"),t.valueStrings.push("bonk"),t.valueStrings.push("boundingBox=1"),t.valueStrings.push("charge=-100"),t.valueStrings.push("velocityDecay=0.9"),t.valueStrings.push("nodeCount=1"),t.valueStrings.push("boon"),t.valueStrings.push("bonk"),t.valueStrings.push("nodeCount=3"),t.valueStrings.push("boon"),t.valueStrings.push("bonk"),t.valueStrings.push("minimalism"),t.nextDocumentMode="spw";return}}function to(t){{const e=Oi(n=>n.id).join(`
`);t.valueStrings.push(e),t.nextDocumentMode="spw";return}}let Ge=[];function eo(t){{const e=Ge.map(n=>n.id).join(`
`);t.nextDocumentMode="spw",t.valueStrings.push(e),Ge=[]}}function rh(t){return B().filter((e,n)=>!t(e,n))}function no(t){return B().filter(e=>e.x>t.x&&e.x<t.x+t.width&&e.y>t.y&&e.y<t.y+t.height)}function B(){return window.spwashi.nodes}function io(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ri={exports:{}},Li={exports:{}};(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(n,i){return n<<i|n>>>32-i},rotr:function(n,i){return n<<32-i|n>>>i},endian:function(n){if(n.constructor==Number)return e.rotl(n,8)&16711935|e.rotl(n,24)&4278255360;for(var i=0;i<n.length;i++)n[i]=e.endian(n[i]);return n},randomBytes:function(n){for(var i=[];n>0;n--)i.push(Math.floor(Math.random()*256));return i},bytesToWords:function(n){for(var i=[],r=0,o=0;r<n.length;r++,o+=8)i[o>>>5]|=n[r]<<24-o%32;return i},wordsToBytes:function(n){for(var i=[],r=0;r<n.length*32;r+=8)i.push(n[r>>>5]>>>24-r%32&255);return i},bytesToHex:function(n){for(var i=[],r=0;r<n.length;r++)i.push((n[r]>>>4).toString(16)),i.push((n[r]&15).toString(16));return i.join("")},hexToBytes:function(n){for(var i=[],r=0;r<n.length;r+=2)i.push(parseInt(n.substr(r,2),16));return i},bytesToBase64:function(n){for(var i=[],r=0;r<n.length;r+=3)for(var o=n[r]<<16|n[r+1]<<8|n[r+2],s=0;s<4;s++)r*8+s*6<=n.length*8?i.push(t.charAt(o>>>6*(3-s)&63)):i.push("=");return i.join("")},base64ToBytes:function(n){n=n.replace(/[^A-Z0-9+\/]/ig,"");for(var i=[],r=0,o=0;r<n.length;o=++r%4)o!=0&&i.push((t.indexOf(n.charAt(r-1))&Math.pow(2,-2*o+8)-1)<<o*2|t.indexOf(n.charAt(r))>>>6-o*2);return i}};Li.exports=e})();var ro=Li.exports,Je={utf8:{stringToBytes:function(t){return Je.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(Je.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],n=0;n<t.length;n++)e.push(t.charCodeAt(n)&255);return e},bytesToString:function(t){for(var e=[],n=0;n<t.length;n++)e.push(String.fromCharCode(t[n]));return e.join("")}}},Pn=Je;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var oo=function(t){return t!=null&&(Pi(t)||so(t)||!!t._isBuffer)};function Pi(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function so(t){return typeof t.readFloatLE=="function"&&typeof t.slice=="function"&&Pi(t.slice(0,0))}(function(){var t=ro,e=Pn.utf8,n=oo,i=Pn.bin,r=function(o,s){o.constructor==String?s&&s.encoding==="binary"?o=i.stringToBytes(o):o=e.stringToBytes(o):n(o)?o=Array.prototype.slice.call(o,0):!Array.isArray(o)&&o.constructor!==Uint8Array&&(o=o.toString());for(var a=t.bytesToWords(o),l=o.length*8,c=1732584193,u=-271733879,f=-1732584194,d=271733878,h=0;h<a.length;h++)a[h]=(a[h]<<8|a[h]>>>24)&16711935|(a[h]<<24|a[h]>>>8)&4278255360;a[l>>>5]|=128<<l%32,a[(l+64>>>9<<4)+14]=l;for(var x=r._ff,w=r._gg,m=r._hh,p=r._ii,h=0;h<a.length;h+=16){var k=c,S=u,y=f,b=d;c=x(c,u,f,d,a[h+0],7,-680876936),d=x(d,c,u,f,a[h+1],12,-389564586),f=x(f,d,c,u,a[h+2],17,606105819),u=x(u,f,d,c,a[h+3],22,-1044525330),c=x(c,u,f,d,a[h+4],7,-176418897),d=x(d,c,u,f,a[h+5],12,1200080426),f=x(f,d,c,u,a[h+6],17,-1473231341),u=x(u,f,d,c,a[h+7],22,-45705983),c=x(c,u,f,d,a[h+8],7,1770035416),d=x(d,c,u,f,a[h+9],12,-1958414417),f=x(f,d,c,u,a[h+10],17,-42063),u=x(u,f,d,c,a[h+11],22,-1990404162),c=x(c,u,f,d,a[h+12],7,1804603682),d=x(d,c,u,f,a[h+13],12,-40341101),f=x(f,d,c,u,a[h+14],17,-1502002290),u=x(u,f,d,c,a[h+15],22,1236535329),c=w(c,u,f,d,a[h+1],5,-165796510),d=w(d,c,u,f,a[h+6],9,-1069501632),f=w(f,d,c,u,a[h+11],14,643717713),u=w(u,f,d,c,a[h+0],20,-373897302),c=w(c,u,f,d,a[h+5],5,-701558691),d=w(d,c,u,f,a[h+10],9,38016083),f=w(f,d,c,u,a[h+15],14,-660478335),u=w(u,f,d,c,a[h+4],20,-405537848),c=w(c,u,f,d,a[h+9],5,568446438),d=w(d,c,u,f,a[h+14],9,-1019803690),f=w(f,d,c,u,a[h+3],14,-187363961),u=w(u,f,d,c,a[h+8],20,1163531501),c=w(c,u,f,d,a[h+13],5,-1444681467),d=w(d,c,u,f,a[h+2],9,-51403784),f=w(f,d,c,u,a[h+7],14,1735328473),u=w(u,f,d,c,a[h+12],20,-1926607734),c=m(c,u,f,d,a[h+5],4,-378558),d=m(d,c,u,f,a[h+8],11,-2022574463),f=m(f,d,c,u,a[h+11],16,1839030562),u=m(u,f,d,c,a[h+14],23,-35309556),c=m(c,u,f,d,a[h+1],4,-1530992060),d=m(d,c,u,f,a[h+4],11,1272893353),f=m(f,d,c,u,a[h+7],16,-155497632),u=m(u,f,d,c,a[h+10],23,-1094730640),c=m(c,u,f,d,a[h+13],4,681279174),d=m(d,c,u,f,a[h+0],11,-358537222),f=m(f,d,c,u,a[h+3],16,-722521979),u=m(u,f,d,c,a[h+6],23,76029189),c=m(c,u,f,d,a[h+9],4,-640364487),d=m(d,c,u,f,a[h+12],11,-421815835),f=m(f,d,c,u,a[h+15],16,530742520),u=m(u,f,d,c,a[h+2],23,-995338651),c=p(c,u,f,d,a[h+0],6,-198630844),d=p(d,c,u,f,a[h+7],10,1126891415),f=p(f,d,c,u,a[h+14],15,-1416354905),u=p(u,f,d,c,a[h+5],21,-57434055),c=p(c,u,f,d,a[h+12],6,1700485571),d=p(d,c,u,f,a[h+3],10,-1894986606),f=p(f,d,c,u,a[h+10],15,-1051523),u=p(u,f,d,c,a[h+1],21,-2054922799),c=p(c,u,f,d,a[h+8],6,1873313359),d=p(d,c,u,f,a[h+15],10,-30611744),f=p(f,d,c,u,a[h+6],15,-1560198380),u=p(u,f,d,c,a[h+13],21,1309151649),c=p(c,u,f,d,a[h+4],6,-145523070),d=p(d,c,u,f,a[h+11],10,-1120210379),f=p(f,d,c,u,a[h+2],15,718787259),u=p(u,f,d,c,a[h+9],21,-343485551),c=c+k>>>0,u=u+S>>>0,f=f+y>>>0,d=d+b>>>0}return t.endian([c,u,f,d])};r._ff=function(o,s,a,l,c,u,f){var d=o+(s&a|~s&l)+(c>>>0)+f;return(d<<u|d>>>32-u)+s},r._gg=function(o,s,a,l,c,u,f){var d=o+(s&l|a&~l)+(c>>>0)+f;return(d<<u|d>>>32-u)+s},r._hh=function(o,s,a,l,c,u,f){var d=o+(s^a^l)+(c>>>0)+f;return(d<<u|d>>>32-u)+s},r._ii=function(o,s,a,l,c,u,f){var d=o+(a^(s|~l))+(c>>>0)+f;return(d<<u|d>>>32-u)+s},r._blocksize=16,r._digestsize=16,Ri.exports=function(o,s){if(o==null)throw new Error("Illegal argument "+o);var a=t.wordsToBytes(r(o,s));return s&&s.asBytes?a:s&&s.asString?i.bytesToString(a):t.bytesToHex(a)}})();var ao=Ri.exports;const pn=io(ao);function Qe(){const t=window.location.href.split("?")[1]||"",e=new URLSearchParams(t),n=new URLSearchParams;return e.has("title ")&&n.set("title",e.get("title")),e.has("size")&&n.set("size",e.get("size")),e.has("superpower")&&n.set("superpower",e.get("superpower")),n}function W(t){var e;return(e=t.kind)==null?void 0:e.trim().split(" + ").reverse()[0]}function co(t){var e;return(e=t.kind)==null?void 0:e.split(" + ")[0]}function mt(t){return t.kind.split(" + ").includes("operator")}function ve(t,e=void 0,n=new URLSearchParams){let i=`/identity/${t}`;return e&&n.set("title",e),n.size&&(i+="?"+(n==null?void 0:n.toString())),i}function Fi(t){return t.md5=t.md5||t.identity&&pn(t.identity)}function Bt(t,e){var y,b,E,I,z,O;if(t.getUrl=()=>{const _=Qe();_.set("superpower","hyperlink");const C=t.md5,R=ve(C,t.identity,_);return t.url=R,R},t.processed)return t;if(t.processed=Date.now(),t.head){const _=t.head,C=t.body,R=t.tail;delete t.head,delete t.body,delete t.tail,t.parts={head:_,body:C,tail:R}}const n=((y=window.spwashi.values.fx)==null?void 0:y[e])||t.fx||void 0,i=((b=window.spwashi.values.fy)==null?void 0:b[e])||t.fy||void 0,r=((E=window.spwashi.values.r)==null?void 0:E[e])||t.r||window.spwashi.parameters.nodes.radiusMultiplier||void 0,o=((z=(I=window.spwashi.values.text)==null?void 0:I.fontSize)==null?void 0:z[e])||((O=t.text)==null?void 0:O.fontSize)||void 0;t.colorindex=kt(),t.fx=n,t.fy=i,t.r=r,t.collisionRadius=r*2,t.text=t.text||{},t.text.fontSize=o,t.image=t.image||{},t.image.r=100,t.image.offsetX=0,t.image.offsetY=0,Fi(t);const s=Qe();t.url=ve(t.md5,t.identity,s);const a=50,l=window.spwashi.parameters.width-50,c=window.spwashi.parameters.height-50,u=[50,50+c/4,50+c/2,50+3*c/4,c],f="conceptual.close",d="conceptual.open",h="essential.close",x="essential.open",w="structural.open",m="structural.close",p="locational.open",k="locational.close";return[[_=>co(_)==="container",{text:{fontSize:10},fx:window.spwashi.parameters.width/2,y:0}],[_=>W(_)==="nominal",{fx:void 0,r:30}],[_=>W(_)==="phrasal",{fx:void 0}],[_=>W(_)==="binding",{fx:100,r:5}],[_=>W(_)==="ordinal",{r:5}],[_=>W(_)===f&&mt(_),{r:10,fx:l,fy:u[0]}],[_=>W(_)===h&&mt(_),{r:10,fx:l,fy:u[1]}],[_=>W(_)===m&&mt(_),{r:10,fx:l,fy:u[2]}],[_=>W(_)===k&&mt(_),{r:10,fx:l,fy:u[3]}],[_=>W(_)===d&&mt(_),{r:10,fx:a,fy:u[0]}],[_=>W(_)===x&&mt(_),{r:10,fx:a,fy:u[1]}],[_=>W(_)===w&&mt(_),{r:10,fx:a,fy:u[2]}],[_=>W(_)===p&&mt(_),{r:10,fx:a,fy:u[3]}]].forEach(([_,C])=>{_(t)&&Object.entries(C).forEach(([R,$])=>{t[R]=$})}),t}const Kt=t=>{window.spwashi.setItem("nodes",B())},lo=t=>{const n=(window.spwashi.getItem("nodes")||[]).find(i=>i.id===t.id);return n||{}},ke=["var(--node-color-0)","var(--node-color-1)","var(--node-color-2)","var(--node-color-3)","var(--node-color-4)","var(--node-color-5)","var(--node-color-6)","var(--node-color-7)","var(--node-color-8)","var(--node-color-9)","var(--node-color-10)","var(--node-color-11)","var(--node-color-12)"],uo=t=>ke[(t.colorindex||0)%ke.length],Ze=t=>t.name,Bi=t=>ke[((t.colorindex||0)+5)%ke.length];function Fn(t,e){let n,i;if(e===void 0)for(const r of t)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));else{let r=-1;for(let o of t)(o=e(o,++r,t))!=null&&(n===void 0?o>=o&&(n=i=o):(n>o&&(n=o),i<o&&(i=o)))}return[n,i]}class Bn extends Map{constructor(e,n=po){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(qn(this,e))}has(e){return super.has(qn(this,e))}set(e,n){return super.set(fo(this,e),n)}delete(e){return super.delete(ho(this,e))}}function qn({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function fo({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):(t.set(i,n),n)}function ho({_intern:t,_key:e},n){const i=e(n);return t.has(i)&&(n=t.get(i),t.delete(i)),n}function po(t){return t!==null&&typeof t=="object"?t.valueOf():t}const wo=Math.sqrt(50),go=Math.sqrt(10),mo=Math.sqrt(2);function _e(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),s=o>=wo?10:o>=go?5:o>=mo?2:1;let a,l,c;return r<0?(c=Math.pow(10,-r)/s,a=Math.round(t*c),l=Math.round(e*c),a/c<t&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,r)*s,a=Math.round(t/c),l=Math.round(e/c),a*c<t&&++a,l*c>e&&--l),l<a&&.5<=n&&n<2?_e(t,e,n*2):[a,l,c]}function yo(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,o,s]=i?_e(e,t,n):_e(t,e,n);if(!(o>=r))return[];const a=o-r+1,l=new Array(a);if(i)if(s<0)for(let c=0;c<a;++c)l[c]=(o-c)/-s;else for(let c=0;c<a;++c)l[c]=(o-c)*s;else if(s<0)for(let c=0;c<a;++c)l[c]=(r+c)/-s;else for(let c=0;c<a;++c)l[c]=(r+c)*s;return l}function tn(t,e,n){return e=+e,t=+t,n=+n,_e(t,e,n)[2]}function xo(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?tn(e,t,n):tn(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}var vo={value:()=>{}};function Zt(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new he(n)}function he(t){this._=t}function ko(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}he.prototype=Zt.prototype={constructor:he,on:function(t,e){var n=this._,i=ko(t+"",n),r,o=-1,s=i.length;if(arguments.length<2){for(;++o<s;)if((r=(t=i[o]).type)&&(r=_o(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(r=(t=i[o]).type)n[r]=Hn(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Hn(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new he(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,o;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],i=0,r=o.length;i<r;++i)o[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(e,n)}};function _o(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Hn(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=vo,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var en="http://www.w3.org/1999/xhtml";const Xn={svg:"http://www.w3.org/2000/svg",xhtml:en,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function $e(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Xn.hasOwnProperty(e)?{space:Xn[e],local:t}:t}function bo(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===en&&e.documentElement.namespaceURI===en?e.createElement(t):e.createElementNS(n,t)}}function So(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function qi(t){var e=$e(t);return(e.local?So:bo)(e)}function No(){}function wn(t){return t==null?No:function(){return this.querySelector(t)}}function Mo(t){typeof t!="function"&&(t=wn(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o=e[r],s=o.length,a=i[r]=new Array(s),l,c,u=0;u<s;++u)(l=o[u])&&(c=t.call(l,l.__data__,u,o))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new V(i,this._parents)}function Co(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Eo(){return[]}function Hi(t){return t==null?Eo:function(){return this.querySelectorAll(t)}}function To(t){return function(){return Co(t.apply(this,arguments))}}function Ao(t){typeof t=="function"?t=To(t):t=Hi(t);for(var e=this._groups,n=e.length,i=[],r=[],o=0;o<n;++o)for(var s=e[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&(i.push(t.call(l,l.__data__,c,s)),r.push(l));return new V(i,r)}function Xi(t){return function(){return this.matches(t)}}function Yi(t){return function(e){return e.matches(t)}}var Io=Array.prototype.find;function zo(t){return function(){return Io.call(this.children,t)}}function Do(){return this.firstElementChild}function Oo(t){return this.select(t==null?Do:zo(typeof t=="function"?t:Yi(t)))}var $o=Array.prototype.filter;function Ro(){return Array.from(this.children)}function Lo(t){return function(){return $o.call(this.children,t)}}function Po(t){return this.selectAll(t==null?Ro:Lo(typeof t=="function"?t:Yi(t)))}function Fo(t){typeof t!="function"&&(t=Xi(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o=e[r],s=o.length,a=i[r]=[],l,c=0;c<s;++c)(l=o[c])&&t.call(l,l.__data__,c,o)&&a.push(l);return new V(i,this._parents)}function Ui(t){return new Array(t.length)}function Bo(){return new V(this._enter||this._groups.map(Ui),this._parents)}function be(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}be.prototype={constructor:be,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function qo(t){return function(){return t}}function Ho(t,e,n,i,r,o){for(var s=0,a,l=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],i[s]=a):n[s]=new be(t,o[s]);for(;s<l;++s)(a=e[s])&&(r[s]=a)}function Xo(t,e,n,i,r,o,s){var a,l,c=new Map,u=e.length,f=o.length,d=new Array(u),h;for(a=0;a<u;++a)(l=e[a])&&(d[a]=h=s.call(l,l.__data__,a,e)+"",c.has(h)?r[a]=l:c.set(h,l));for(a=0;a<f;++a)h=s.call(t,o[a],a,o)+"",(l=c.get(h))?(i[a]=l,l.__data__=o[a],c.delete(h)):n[a]=new be(t,o[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(d[a])===l&&(r[a]=l)}function Yo(t){return t.__data__}function Uo(t,e){if(!arguments.length)return Array.from(this,Yo);var n=e?Xo:Ho,i=this._parents,r=this._groups;typeof t!="function"&&(t=qo(t));for(var o=r.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=i[c],f=r[c],d=f.length,h=Ko(t.call(u,u&&u.__data__,c,i)),x=h.length,w=a[c]=new Array(x),m=s[c]=new Array(x),p=l[c]=new Array(d);n(u,f,w,m,p,h,e);for(var k=0,S=0,y,b;k<x;++k)if(y=w[k]){for(k>=S&&(S=k+1);!(b=m[S])&&++S<x;);y._next=b||null}}return s=new V(s,i),s._enter=a,s._exit=l,s}function Ko(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function jo(){return new V(this._exit||this._groups.map(Ui),this._parents)}function Vo(t,e,n){var i=this.enter(),r=this,o=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?o.remove():n(o),i&&r?i.merge(r).order():r}function Wo(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,o=i.length,s=Math.min(r,o),a=new Array(r),l=0;l<s;++l)for(var c=n[l],u=i[l],f=c.length,d=a[l]=new Array(f),h,x=0;x<f;++x)(h=c[x]||u[x])&&(d[x]=h);for(;l<r;++l)a[l]=n[l];return new V(a,this._parents)}function Go(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,o=i[r],s;--r>=0;)(s=i[r])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function Jo(t){t||(t=Qo);function e(f,d){return f&&d?t(f.__data__,d.__data__):!f-!d}for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var s=n[o],a=s.length,l=r[o]=new Array(a),c,u=0;u<a;++u)(c=s[u])&&(l[u]=c);l.sort(e)}return new V(r,this._parents).order()}function Qo(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Zo(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function ts(){return Array.from(this)}function es(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null}function ns(){let t=0;for(const e of this)++t;return t}function is(){return!this.node()}function rs(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],o=0,s=r.length,a;o<s;++o)(a=r[o])&&t.call(a,a.__data__,o,r);return this}function os(t){return function(){this.removeAttribute(t)}}function ss(t){return function(){this.removeAttributeNS(t.space,t.local)}}function as(t,e){return function(){this.setAttribute(t,e)}}function cs(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ls(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function us(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function fs(t,e){var n=$e(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?ss:os:typeof e=="function"?n.local?us:ls:n.local?cs:as)(n,e))}function Ki(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function ds(t){return function(){this.style.removeProperty(t)}}function hs(t,e,n){return function(){this.style.setProperty(t,e,n)}}function ps(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function ws(t,e,n){return arguments.length>1?this.each((e==null?ds:typeof e=="function"?ps:hs)(t,e,n??"")):Lt(this.node(),t)}function Lt(t,e){return t.style.getPropertyValue(e)||Ki(t).getComputedStyle(t,null).getPropertyValue(e)}function gs(t){return function(){delete this[t]}}function ms(t,e){return function(){this[t]=e}}function ys(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function xs(t,e){return arguments.length>1?this.each((e==null?gs:typeof e=="function"?ys:ms)(t,e)):this.node()[t]}function ji(t){return t.trim().split(/^|\s+/)}function gn(t){return t.classList||new Vi(t)}function Vi(t){this._node=t,this._names=ji(t.getAttribute("class")||"")}Vi.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Wi(t,e){for(var n=gn(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Gi(t,e){for(var n=gn(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function vs(t){return function(){Wi(this,t)}}function ks(t){return function(){Gi(this,t)}}function _s(t,e){return function(){(e.apply(this,arguments)?Wi:Gi)(this,t)}}function bs(t,e){var n=ji(t+"");if(arguments.length<2){for(var i=gn(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?_s:e?vs:ks)(n,e))}function Ss(){this.textContent=""}function Ns(t){return function(){this.textContent=t}}function Ms(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Cs(t){return arguments.length?this.each(t==null?Ss:(typeof t=="function"?Ms:Ns)(t)):this.node().textContent}function Es(){this.innerHTML=""}function Ts(t){return function(){this.innerHTML=t}}function As(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Is(t){return arguments.length?this.each(t==null?Es:(typeof t=="function"?As:Ts)(t)):this.node().innerHTML}function zs(){this.nextSibling&&this.parentNode.appendChild(this)}function Ds(){return this.each(zs)}function Os(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function $s(){return this.each(Os)}function Rs(t){var e=typeof t=="function"?t:qi(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Ls(){return null}function Ps(t,e){var n=typeof t=="function"?t:qi(t),i=e==null?Ls:typeof e=="function"?e:wn(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Fs(){var t=this.parentNode;t&&t.removeChild(this)}function Bs(){return this.each(Fs)}function qs(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Hs(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Xs(t){return this.select(t?Hs:qs)}function Ys(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Us(t){return function(e){t.call(this,e,this.__data__)}}function Ks(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function js(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,o;n<r;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++i]=o;++i?e.length=i:delete this.__on}}}function Vs(t,e,n){return function(){var i=this.__on,r,o=Us(e);if(i){for(var s=0,a=i.length;s<a;++s)if((r=i[s]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),r.value=e;return}}this.addEventListener(t.type,o,n),r={type:t.type,name:t.name,value:e,listener:o,options:n},i?i.push(r):this.__on=[r]}}function Ws(t,e,n){var i=Ks(t+""),r,o=i.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(r=0,u=a[l];r<o;++r)if((s=i[r]).type===u.type&&s.name===u.name)return u.value}return}for(a=e?Vs:js,r=0;r<o;++r)this.each(a(i[r],e,n));return this}function Ji(t,e,n){var i=Ki(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Gs(t,e){return function(){return Ji(this,t,e)}}function Js(t,e){return function(){return Ji(this,t,e.apply(this,arguments))}}function Qs(t,e){return this.each((typeof e=="function"?Js:Gs)(t,e))}function*Zs(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length,s;r<o;++r)(s=i[r])&&(yield s)}var Qi=[null];function V(t,e){this._groups=t,this._parents=e}function te(){return new V([[document.documentElement]],Qi)}function ta(){return this}V.prototype=te.prototype={constructor:V,select:Mo,selectAll:Ao,selectChild:Oo,selectChildren:Po,filter:Fo,data:Uo,enter:Bo,exit:jo,join:Vo,merge:Wo,selection:ta,order:Go,sort:Jo,call:Zo,nodes:ts,node:es,size:ns,empty:is,each:rs,attr:fs,style:ws,property:xs,classed:bs,text:Cs,html:Is,raise:Ds,lower:$s,append:Rs,insert:Ps,remove:Bs,clone:Xs,datum:Ys,on:Ws,dispatch:Qs,[Symbol.iterator]:Zs};function ot(t){return typeof t=="string"?new V([[document.querySelector(t)]],[document.documentElement]):new V([[t]],Qi)}function ea(t){let e;for(;e=t.sourceEvent;)t=e;return t}function ft(t,e){if(t=ea(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}const na={passive:!1},jt={capture:!0,passive:!1};function He(t){t.stopImmediatePropagation()}function Ot(t){t.preventDefault(),t.stopImmediatePropagation()}function Zi(t){var e=t.document.documentElement,n=ot(t).on("dragstart.drag",Ot,jt);"onselectstart"in e?n.on("selectstart.drag",Ot,jt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function tr(t,e){var n=t.document.documentElement,i=ot(t).on("dragstart.drag",null);e&&(i.on("click.drag",Ot,jt),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const re=t=>()=>t;function nn(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:o,x:s,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}nn.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function ia(t){return!t.ctrlKey&&!t.button}function ra(){return this.parentNode}function oa(t,e){return e??{x:t.x,y:t.y}}function sa(){return navigator.maxTouchPoints||"ontouchstart"in this}function Re(){var t=ia,e=ra,n=oa,i=sa,r={},o=Zt("start","drag","end"),s=0,a,l,c,u,f=0;function d(y){y.on("mousedown.drag",h).filter(i).on("touchstart.drag",m).on("touchmove.drag",p,na).on("touchend.drag touchcancel.drag",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(y,b){if(!(u||!t.call(this,y,b))){var E=S(this,e.call(this,y,b),y,b,"mouse");E&&(ot(y.view).on("mousemove.drag",x,jt).on("mouseup.drag",w,jt),Zi(y.view),He(y),c=!1,a=y.clientX,l=y.clientY,E("start",y))}}function x(y){if(Ot(y),!c){var b=y.clientX-a,E=y.clientY-l;c=b*b+E*E>f}r.mouse("drag",y)}function w(y){ot(y.view).on("mousemove.drag mouseup.drag",null),tr(y.view,c),Ot(y),r.mouse("end",y)}function m(y,b){if(t.call(this,y,b)){var E=y.changedTouches,I=e.call(this,y,b),z=E.length,O,_;for(O=0;O<z;++O)(_=S(this,I,y,b,E[O].identifier,E[O]))&&(He(y),_("start",y,E[O]))}}function p(y){var b=y.changedTouches,E=b.length,I,z;for(I=0;I<E;++I)(z=r[b[I].identifier])&&(Ot(y),z("drag",y,b[I]))}function k(y){var b=y.changedTouches,E=b.length,I,z;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),I=0;I<E;++I)(z=r[b[I].identifier])&&(He(y),z("end",y,b[I]))}function S(y,b,E,I,z,O){var _=o.copy(),C=ft(O||E,b),R,$,g;if((g=n.call(y,new nn("beforestart",{sourceEvent:E,target:d,identifier:z,active:s,x:C[0],y:C[1],dx:0,dy:0,dispatch:_}),I))!=null)return R=g.x-C[0]||0,$=g.y-C[1]||0,function N(v,M,A){var T=C,D;switch(v){case"start":r[z]=N,D=s++;break;case"end":delete r[z],--s;case"drag":C=ft(A||M,b),D=s;break}_.call(v,y,new nn(v,{sourceEvent:M,subject:g,target:d,identifier:z,active:D,x:C[0]+R,y:C[1]+$,dx:C[0]-T[0],dy:C[1]-T[1],dispatch:_}),I)}}return d.filter=function(y){return arguments.length?(t=typeof y=="function"?y:re(!!y),d):t},d.container=function(y){return arguments.length?(e=typeof y=="function"?y:re(y),d):e},d.subject=function(y){return arguments.length?(n=typeof y=="function"?y:re(y),d):n},d.touchable=function(y){return arguments.length?(i=typeof y=="function"?y:re(!!y),d):i},d.on=function(){var y=o.on.apply(o,arguments);return y===o?d:y},d.clickDistance=function(y){return arguments.length?(f=(y=+y)*y,d):Math.sqrt(f)},d}function mn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function er(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function ee(){}var Vt=.7,Se=1/Vt,$t="\\s*([+-]?\\d+)\\s*",Wt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",st="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",aa=/^#([0-9a-f]{3,8})$/,ca=new RegExp(`^rgb\\(${$t},${$t},${$t}\\)$`),la=new RegExp(`^rgb\\(${st},${st},${st}\\)$`),ua=new RegExp(`^rgba\\(${$t},${$t},${$t},${Wt}\\)$`),fa=new RegExp(`^rgba\\(${st},${st},${st},${Wt}\\)$`),da=new RegExp(`^hsl\\(${Wt},${st},${st}\\)$`),ha=new RegExp(`^hsla\\(${Wt},${st},${st},${Wt}\\)$`),Yn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};mn(ee,Ct,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Un,formatHex:Un,formatHex8:pa,formatHsl:wa,formatRgb:Kn,toString:Kn});function Un(){return this.rgb().formatHex()}function pa(){return this.rgb().formatHex8()}function wa(){return nr(this).formatHsl()}function Kn(){return this.rgb().formatRgb()}function Ct(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=aa.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?jn(e):n===3?new U(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?oe(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?oe(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=ca.exec(t))?new U(e[1],e[2],e[3],1):(e=la.exec(t))?new U(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=ua.exec(t))?oe(e[1],e[2],e[3],e[4]):(e=fa.exec(t))?oe(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=da.exec(t))?Gn(e[1],e[2]/100,e[3]/100,1):(e=ha.exec(t))?Gn(e[1],e[2]/100,e[3]/100,e[4]):Yn.hasOwnProperty(t)?jn(Yn[t]):t==="transparent"?new U(NaN,NaN,NaN,0):null}function jn(t){return new U(t>>16&255,t>>8&255,t&255,1)}function oe(t,e,n,i){return i<=0&&(t=e=n=NaN),new U(t,e,n,i)}function ga(t){return t instanceof ee||(t=Ct(t)),t?(t=t.rgb(),new U(t.r,t.g,t.b,t.opacity)):new U}function rn(t,e,n,i){return arguments.length===1?ga(t):new U(t,e,n,i??1)}function U(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}mn(U,rn,er(ee,{brighter(t){return t=t==null?Se:Math.pow(Se,t),new U(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Vt:Math.pow(Vt,t),new U(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new U(St(this.r),St(this.g),St(this.b),Ne(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Vn,formatHex:Vn,formatHex8:ma,formatRgb:Wn,toString:Wn}));function Vn(){return`#${bt(this.r)}${bt(this.g)}${bt(this.b)}`}function ma(){return`#${bt(this.r)}${bt(this.g)}${bt(this.b)}${bt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Wn(){const t=Ne(this.opacity);return`${t===1?"rgb(":"rgba("}${St(this.r)}, ${St(this.g)}, ${St(this.b)}${t===1?")":`, ${t})`}`}function Ne(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function St(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function bt(t){return t=St(t),(t<16?"0":"")+t.toString(16)}function Gn(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new tt(t,e,n,i)}function nr(t){if(t instanceof tt)return new tt(t.h,t.s,t.l,t.opacity);if(t instanceof ee||(t=Ct(t)),!t)return new tt;if(t instanceof tt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),o=Math.max(e,n,i),s=NaN,a=o-r,l=(o+r)/2;return a?(e===o?s=(n-i)/a+(n<i)*6:n===o?s=(i-e)/a+2:s=(e-n)/a+4,a/=l<.5?o+r:2-o-r,s*=60):a=l>0&&l<1?0:s,new tt(s,a,l,t.opacity)}function ya(t,e,n,i){return arguments.length===1?nr(t):new tt(t,e,n,i??1)}function tt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}mn(tt,ya,er(ee,{brighter(t){return t=t==null?Se:Math.pow(Se,t),new tt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Vt:Math.pow(Vt,t),new tt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new U(Xe(t>=240?t-240:t+120,r,i),Xe(t,r,i),Xe(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new tt(Jn(this.h),se(this.s),se(this.l),Ne(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ne(this.opacity);return`${t===1?"hsl(":"hsla("}${Jn(this.h)}, ${se(this.s)*100}%, ${se(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Jn(t){return t=(t||0)%360,t<0?t+360:t}function se(t){return Math.max(0,Math.min(1,t||0))}function Xe(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const yn=t=>()=>t;function xa(t,e){return function(n){return t+n*e}}function va(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function ka(t){return(t=+t)==1?ir:function(e,n){return n-e?va(e,n,t):yn(isNaN(e)?n:e)}}function ir(t,e){var n=e-t;return n?xa(t,n):yn(isNaN(t)?e:t)}const Me=function t(e){var n=ka(e);function i(r,o){var s=n((r=rn(r)).r,(o=rn(o)).r),a=n(r.g,o.g),l=n(r.b,o.b),c=ir(r.opacity,o.opacity);return function(u){return r.r=s(u),r.g=a(u),r.b=l(u),r.opacity=c(u),r+""}}return i.gamma=t,i}(1);function _a(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(o){for(r=0;r<n;++r)i[r]=t[r]*(1-o)+e[r]*o;return i}}function ba(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Sa(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),o=new Array(n),s;for(s=0;s<i;++s)r[s]=xn(t[s],e[s]);for(;s<n;++s)o[s]=e[s];return function(a){for(s=0;s<i;++s)o[s]=r[s](a);return o}}function Na(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function rt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Ma(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=xn(t[r],e[r]):i[r]=e[r];return function(o){for(r in n)i[r]=n[r](o);return i}}var on=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ye=new RegExp(on.source,"g");function Ca(t){return function(){return t}}function Ea(t){return function(e){return t(e)+""}}function rr(t,e){var n=on.lastIndex=Ye.lastIndex=0,i,r,o,s=-1,a=[],l=[];for(t=t+"",e=e+"";(i=on.exec(t))&&(r=Ye.exec(e));)(o=r.index)>n&&(o=e.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(i=i[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,l.push({i:s,x:rt(i,r)})),n=Ye.lastIndex;return n<e.length&&(o=e.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?Ea(l[0].x):Ca(e):(e=l.length,function(c){for(var u=0,f;u<e;++u)a[(f=l[u]).i]=f.x(c);return a.join("")})}function xn(t,e){var n=typeof e,i;return e==null||n==="boolean"?yn(e):(n==="number"?rt:n==="string"?(i=Ct(e))?(e=i,Me):rr:e instanceof Ct?Me:e instanceof Date?Na:ba(e)?_a:Array.isArray(e)?Sa:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Ma:rt)(t,e)}function Ta(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Qn=180/Math.PI,sn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function or(t,e,n,i,r,o){var s,a,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),t*i<e*n&&(t=-t,e=-e,l=-l,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(e,t)*Qn,skewX:Math.atan(l)*Qn,scaleX:s,scaleY:a}}var ae;function Aa(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?sn:or(e.a,e.b,e.c,e.d,e.e,e.f)}function Ia(t){return t==null||(ae||(ae=document.createElementNS("http://www.w3.org/2000/svg","g")),ae.setAttribute("transform",t),!(t=ae.transform.baseVal.consolidate()))?sn:(t=t.matrix,or(t.a,t.b,t.c,t.d,t.e,t.f))}function sr(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function o(c,u,f,d,h,x){if(c!==f||u!==d){var w=h.push("translate(",null,e,null,n);x.push({i:w-4,x:rt(c,f)},{i:w-2,x:rt(u,d)})}else(f||d)&&h.push("translate("+f+e+d+n)}function s(c,u,f,d){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),d.push({i:f.push(r(f)+"rotate(",null,i)-2,x:rt(c,u)})):u&&f.push(r(f)+"rotate("+u+i)}function a(c,u,f,d){c!==u?d.push({i:f.push(r(f)+"skewX(",null,i)-2,x:rt(c,u)}):u&&f.push(r(f)+"skewX("+u+i)}function l(c,u,f,d,h,x){if(c!==f||u!==d){var w=h.push(r(h)+"scale(",null,",",null,")");x.push({i:w-4,x:rt(c,f)},{i:w-2,x:rt(u,d)})}else(f!==1||d!==1)&&h.push(r(h)+"scale("+f+","+d+")")}return function(c,u){var f=[],d=[];return c=t(c),u=t(u),o(c.translateX,c.translateY,u.translateX,u.translateY,f,d),s(c.rotate,u.rotate,f,d),a(c.skewX,u.skewX,f,d),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,f,d),c=u=null,function(h){for(var x=-1,w=d.length,m;++x<w;)f[(m=d[x]).i]=m.x(h);return f.join("")}}}var za=sr(Aa,"px, ","px)","deg)"),Da=sr(Ia,", ",")",")"),Oa=1e-12;function Zn(t){return((t=Math.exp(t))+1/t)/2}function $a(t){return((t=Math.exp(t))-1/t)/2}function Ra(t){return((t=Math.exp(2*t))-1)/(t+1)}const La=function t(e,n,i){function r(o,s){var a=o[0],l=o[1],c=o[2],u=s[0],f=s[1],d=s[2],h=u-a,x=f-l,w=h*h+x*x,m,p;if(w<Oa)p=Math.log(d/c)/e,m=function(I){return[a+I*h,l+I*x,c*Math.exp(e*I*p)]};else{var k=Math.sqrt(w),S=(d*d-c*c+i*w)/(2*c*n*k),y=(d*d-c*c-i*w)/(2*d*n*k),b=Math.log(Math.sqrt(S*S+1)-S),E=Math.log(Math.sqrt(y*y+1)-y);p=(E-b)/e,m=function(I){var z=I*p,O=Zn(b),_=c/(n*k)*(O*Ra(e*z+b)-$a(b));return[a+_*h,l+_*x,c*O/Zn(e*z+b)]}}return m.duration=p*1e3*e/Math.SQRT2,m}return r.rho=function(o){var s=Math.max(.001,+o),a=s*s,l=a*a;return t(s,a,l)},r}(Math.SQRT2,2,4);var Pt=0,Xt=0,qt=0,ar=1e3,Ce,Yt,Ee=0,Et=0,Le=0,Gt=typeof performance=="object"&&performance.now?performance:Date,cr=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function vn(){return Et||(cr(Pa),Et=Gt.now()+Le)}function Pa(){Et=0}function Te(){this._call=this._time=this._next=null}Te.prototype=kn.prototype={constructor:Te,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?vn():+n)+(e==null?0:+e),!this._next&&Yt!==this&&(Yt?Yt._next=this:Ce=this,Yt=this),this._call=t,this._time=n,an()},stop:function(){this._call&&(this._call=null,this._time=1/0,an())}};function kn(t,e,n){var i=new Te;return i.restart(t,e,n),i}function Fa(){vn(),++Pt;for(var t=Ce,e;t;)(e=Et-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Pt}function ti(){Et=(Ee=Gt.now())+Le,Pt=Xt=0;try{Fa()}finally{Pt=0,qa(),Et=0}}function Ba(){var t=Gt.now(),e=t-Ee;e>ar&&(Le-=e,Ee=t)}function qa(){for(var t,e=Ce,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Ce=n);Yt=t,an(i)}function an(t){if(!Pt){Xt&&(Xt=clearTimeout(Xt));var e=t-Et;e>24?(t<1/0&&(Xt=setTimeout(ti,t-Gt.now()-Le)),qt&&(qt=clearInterval(qt))):(qt||(Ee=Gt.now(),qt=setInterval(Ba,ar)),Pt=1,cr(ti))}}function ei(t,e,n){var i=new Te;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var Ha=Zt("start","end","cancel","interrupt"),Xa=[],lr=0,ni=1,cn=2,pe=3,ii=4,ln=5,we=6;function Pe(t,e,n,i,r,o){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;Ya(t,n,{name:e,index:i,group:r,on:Ha,tween:Xa,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:lr})}function _n(t,e){var n=nt(t,e);if(n.state>lr)throw new Error("too late; already scheduled");return n}function at(t,e){var n=nt(t,e);if(n.state>pe)throw new Error("too late; already running");return n}function nt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Ya(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=kn(o,0,n.time);function o(c){n.state=ni,n.timer.restart(s,n.delay,n.time),n.delay<=c&&s(c-n.delay)}function s(c){var u,f,d,h;if(n.state!==ni)return l();for(u in i)if(h=i[u],h.name===n.name){if(h.state===pe)return ei(s);h.state===ii?(h.state=we,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete i[u]):+u<e&&(h.state=we,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete i[u])}if(ei(function(){n.state===pe&&(n.state=ii,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=cn,n.on.call("start",t,t.__data__,n.index,n.group),n.state===cn){for(n.state=pe,r=new Array(d=n.tween.length),u=0,f=-1;u<d;++u)(h=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++f]=h);r.length=f+1}}function a(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(l),n.state=ln,1),f=-1,d=r.length;++f<d;)r[f].call(t,u);n.state===ln&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){n.state=we,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function ge(t,e){var n=t.__transition,i,r,o=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((i=n[s]).name!==e){o=!1;continue}r=i.state>cn&&i.state<ln,i.state=we,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[s]}o&&delete t.__transition}}function Ua(t){return this.each(function(){ge(this,t)})}function Ka(t,e){var n,i;return function(){var r=at(this,t),o=r.tween;if(o!==n){i=n=o;for(var s=0,a=i.length;s<a;++s)if(i[s].name===e){i=i.slice(),i.splice(s,1);break}}r.tween=i}}function ja(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var o=at(this,t),s=o.tween;if(s!==i){r=(i=s).slice();for(var a={name:e,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=a;break}l===c&&r.push(a)}o.tween=r}}function Va(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=nt(this.node(),n).tween,r=0,o=i.length,s;r<o;++r)if((s=i[r]).name===t)return s.value;return null}return this.each((e==null?Ka:ja)(n,t,e))}function bn(t,e,n){var i=t._id;return t.each(function(){var r=at(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return nt(r,i).value[e]}}function ur(t,e){var n;return(typeof e=="number"?rt:e instanceof Ct?Me:(n=Ct(e))?(e=n,Me):rr)(t,e)}function Wa(t){return function(){this.removeAttribute(t)}}function Ga(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ja(t,e,n){var i,r=n+"",o;return function(){var s=this.getAttribute(t);return s===r?null:s===i?o:o=e(i=s,n)}}function Qa(t,e,n){var i,r=n+"",o;return function(){var s=this.getAttributeNS(t.space,t.local);return s===r?null:s===i?o:o=e(i=s,n)}}function Za(t,e,n){var i,r,o;return function(){var s,a=n(this),l;return a==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=a+"",s===l?null:s===i&&l===r?o:(r=l,o=e(i=s,a)))}}function tc(t,e,n){var i,r,o;return function(){var s,a=n(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=a+"",s===l?null:s===i&&l===r?o:(r=l,o=e(i=s,a)))}}function ec(t,e){var n=$e(t),i=n==="transform"?Da:ur;return this.attrTween(t,typeof e=="function"?(n.local?tc:Za)(n,i,bn(this,"attr."+t,e)):e==null?(n.local?Ga:Wa)(n):(n.local?Qa:Ja)(n,i,e))}function nc(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function ic(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function rc(t,e){var n,i;function r(){var o=e.apply(this,arguments);return o!==i&&(n=(i=o)&&ic(t,o)),n}return r._value=e,r}function oc(t,e){var n,i;function r(){var o=e.apply(this,arguments);return o!==i&&(n=(i=o)&&nc(t,o)),n}return r._value=e,r}function sc(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=$e(t);return this.tween(n,(i.local?rc:oc)(i,e))}function ac(t,e){return function(){_n(this,t).delay=+e.apply(this,arguments)}}function cc(t,e){return e=+e,function(){_n(this,t).delay=e}}function lc(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ac:cc)(e,t)):nt(this.node(),e).delay}function uc(t,e){return function(){at(this,t).duration=+e.apply(this,arguments)}}function fc(t,e){return e=+e,function(){at(this,t).duration=e}}function dc(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?uc:fc)(e,t)):nt(this.node(),e).duration}function hc(t,e){if(typeof e!="function")throw new Error;return function(){at(this,t).ease=e}}function pc(t){var e=this._id;return arguments.length?this.each(hc(e,t)):nt(this.node(),e).ease}function wc(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;at(this,t).ease=n}}function gc(t){if(typeof t!="function")throw new Error;return this.each(wc(this._id,t))}function mc(t){typeof t!="function"&&(t=Xi(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o=e[r],s=o.length,a=i[r]=[],l,c=0;c<s;++c)(l=o[c])&&t.call(l,l.__data__,c,o)&&a.push(l);return new wt(i,this._parents,this._name,this._id)}function yc(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),s=new Array(i),a=0;a<o;++a)for(var l=e[a],c=n[a],u=l.length,f=s[a]=new Array(u),d,h=0;h<u;++h)(d=l[h]||c[h])&&(f[h]=d);for(;a<i;++a)s[a]=e[a];return new wt(s,this._parents,this._name,this._id)}function xc(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function vc(t,e,n){var i,r,o=xc(e)?_n:at;return function(){var s=o(this,t),a=s.on;a!==i&&(r=(i=a).copy()).on(e,n),s.on=r}}function kc(t,e){var n=this._id;return arguments.length<2?nt(this.node(),n).on.on(t):this.each(vc(n,t,e))}function _c(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function bc(){return this.on("end.remove",_c(this._id))}function Sc(t){var e=this._name,n=this._id;typeof t!="function"&&(t=wn(t));for(var i=this._groups,r=i.length,o=new Array(r),s=0;s<r;++s)for(var a=i[s],l=a.length,c=o[s]=new Array(l),u,f,d=0;d<l;++d)(u=a[d])&&(f=t.call(u,u.__data__,d,a))&&("__data__"in u&&(f.__data__=u.__data__),c[d]=f,Pe(c[d],e,n,d,c,nt(u,n)));return new wt(o,this._parents,e,n)}function Nc(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Hi(t));for(var i=this._groups,r=i.length,o=[],s=[],a=0;a<r;++a)for(var l=i[a],c=l.length,u,f=0;f<c;++f)if(u=l[f]){for(var d=t.call(u,u.__data__,f,l),h,x=nt(u,n),w=0,m=d.length;w<m;++w)(h=d[w])&&Pe(h,e,n,w,d,x);o.push(d),s.push(u)}return new wt(o,s,e,n)}var Mc=te.prototype.constructor;function Cc(){return new Mc(this._groups,this._parents)}function Ec(t,e){var n,i,r;return function(){var o=Lt(this,t),s=(this.style.removeProperty(t),Lt(this,t));return o===s?null:o===n&&s===i?r:r=e(n=o,i=s)}}function fr(t){return function(){this.style.removeProperty(t)}}function Tc(t,e,n){var i,r=n+"",o;return function(){var s=Lt(this,t);return s===r?null:s===i?o:o=e(i=s,n)}}function Ac(t,e,n){var i,r,o;return function(){var s=Lt(this,t),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),Lt(this,t))),s===l?null:s===i&&l===r?o:(r=l,o=e(i=s,a))}}function Ic(t,e){var n,i,r,o="style."+e,s="end."+o,a;return function(){var l=at(this,t),c=l.on,u=l.value[o]==null?a||(a=fr(e)):void 0;(c!==n||r!==u)&&(i=(n=c).copy()).on(s,r=u),l.on=i}}function zc(t,e,n){var i=(t+="")=="transform"?za:ur;return e==null?this.styleTween(t,Ec(t,i)).on("end.style."+t,fr(t)):typeof e=="function"?this.styleTween(t,Ac(t,i,bn(this,"style."+t,e))).each(Ic(this._id,t)):this.styleTween(t,Tc(t,i,e),n).on("end.style."+t,null)}function Dc(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function Oc(t,e,n){var i,r;function o(){var s=e.apply(this,arguments);return s!==r&&(i=(r=s)&&Dc(t,s,n)),i}return o._value=e,o}function $c(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Oc(t,e,n??""))}function Rc(t){return function(){this.textContent=t}}function Lc(t){return function(){var e=t(this);this.textContent=e??""}}function Pc(t){return this.tween("text",typeof t=="function"?Lc(bn(this,"text",t)):Rc(t==null?"":t+""))}function Fc(t){return function(e){this.textContent=t.call(this,e)}}function Bc(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&Fc(r)),e}return i._value=t,i}function qc(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Bc(t))}function Hc(){for(var t=this._name,e=this._id,n=dr(),i=this._groups,r=i.length,o=0;o<r;++o)for(var s=i[o],a=s.length,l,c=0;c<a;++c)if(l=s[c]){var u=nt(l,e);Pe(l,t,n,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new wt(i,this._parents,t,n)}function Xc(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--r===0&&o()}};n.each(function(){var c=at(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),r===0&&o()})}var Yc=0;function wt(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function dr(){return++Yc}var ut=te.prototype;wt.prototype={constructor:wt,select:Sc,selectAll:Nc,selectChild:ut.selectChild,selectChildren:ut.selectChildren,filter:mc,merge:yc,selection:Cc,transition:Hc,call:ut.call,nodes:ut.nodes,node:ut.node,size:ut.size,empty:ut.empty,each:ut.each,on:kc,attr:ec,attrTween:sc,style:zc,styleTween:$c,text:Pc,textTween:qc,remove:bc,tween:Va,delay:lc,duration:dc,ease:pc,easeVarying:gc,end:Xc,[Symbol.iterator]:ut[Symbol.iterator]};function Uc(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Kc={time:null,delay:0,duration:250,ease:Uc};function jc(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Vc(t){var e,n;t instanceof wt?(e=t._id,t=t._name):(e=dr(),(n=Kc).time=vn(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var s=i[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&Pe(l,t,e,c,s,n||jc(l,e));return new wt(i,this._parents,t,e)}te.prototype.interrupt=Ua;te.prototype.transition=Vc;function Wc(t,e){var n,i=1;t==null&&(t=0),e==null&&(e=0);function r(){var o,s=n.length,a,l=0,c=0;for(o=0;o<s;++o)a=n[o],l+=a.x,c+=a.y;for(l=(l/s-t)*i,c=(c/s-e)*i,o=0;o<s;++o)a=n[o],a.x-=l,a.y-=c}return r.initialize=function(o){n=o},r.x=function(o){return arguments.length?(t=+o,r):t},r.y=function(o){return arguments.length?(e=+o,r):e},r.strength=function(o){return arguments.length?(i=+o,r):i},r}function Gc(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return hr(this.cover(e,n),e,n,t)}function hr(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,o=t._root,s={data:i},a=t._x0,l=t._y0,c=t._x1,u=t._y1,f,d,h,x,w,m,p,k;if(!o)return t._root=s,t;for(;o.length;)if((w=e>=(f=(a+c)/2))?a=f:c=f,(m=n>=(d=(l+u)/2))?l=d:u=d,r=o,!(o=o[p=m<<1|w]))return r[p]=s,t;if(h=+t._x.call(null,o.data),x=+t._y.call(null,o.data),e===h&&n===x)return s.next=o,r?r[p]=s:t._root=s,t;do r=r?r[p]=new Array(4):t._root=new Array(4),(w=e>=(f=(a+c)/2))?a=f:c=f,(m=n>=(d=(l+u)/2))?l=d:u=d;while((p=m<<1|w)===(k=(x>=d)<<1|h>=f));return r[k]=o,r[p]=s,t}function Jc(t){var e,n,i=t.length,r,o,s=new Array(i),a=new Array(i),l=1/0,c=1/0,u=-1/0,f=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(o=+this._y.call(null,e))||(s[n]=r,a[n]=o,r<l&&(l=r),r>u&&(u=r),o<c&&(c=o),o>f&&(f=o));if(l>u||c>f)return this;for(this.cover(l,c).cover(u,f),n=0;n<i;++n)hr(this,s[n],a[n],t[n]);return this}function Qc(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,o=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,o=(i=Math.floor(e))+1;else{for(var s=r-n||1,a=this._root,l,c;n>t||t>=r||i>e||e>=o;)switch(c=(e<i)<<1|t<n,l=new Array(4),l[c]=a,a=l,s*=2,c){case 0:r=n+s,o=i+s;break;case 1:n=r-s,o=i+s;break;case 2:r=n+s,i=o-s;break;case 3:n=r-s,i=o-s;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=i,this._x1=r,this._y1=o,this}function Zc(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function tl(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function X(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function el(t,e,n){var i,r=this._x0,o=this._y0,s,a,l,c,u=this._x1,f=this._y1,d=[],h=this._root,x,w;for(h&&d.push(new X(h,r,o,u,f)),n==null?n=1/0:(r=t-n,o=e-n,u=t+n,f=e+n,n*=n);x=d.pop();)if(!(!(h=x.node)||(s=x.x0)>u||(a=x.y0)>f||(l=x.x1)<r||(c=x.y1)<o))if(h.length){var m=(s+l)/2,p=(a+c)/2;d.push(new X(h[3],m,p,l,c),new X(h[2],s,p,m,c),new X(h[1],m,a,l,p),new X(h[0],s,a,m,p)),(w=(e>=p)<<1|t>=m)&&(x=d[d.length-1],d[d.length-1]=d[d.length-1-w],d[d.length-1-w]=x)}else{var k=t-+this._x.call(null,h.data),S=e-+this._y.call(null,h.data),y=k*k+S*S;if(y<n){var b=Math.sqrt(n=y);r=t-b,o=e-b,u=t+b,f=e+b,i=h.data}}return i}function nl(t){if(isNaN(u=+this._x.call(null,t))||isNaN(f=+this._y.call(null,t)))return this;var e,n=this._root,i,r,o,s=this._x0,a=this._y0,l=this._x1,c=this._y1,u,f,d,h,x,w,m,p;if(!n)return this;if(n.length)for(;;){if((x=u>=(d=(s+l)/2))?s=d:l=d,(w=f>=(h=(a+c)/2))?a=h:c=h,e=n,!(n=n[m=w<<1|x]))return this;if(!n.length)break;(e[m+1&3]||e[m+2&3]||e[m+3&3])&&(i=e,p=m)}for(;n.data!==t;)if(r=n,!(n=n.next))return this;return(o=n.next)&&delete n.next,r?(o?r.next=o:delete r.next,this):e?(o?e[m]=o:delete e[m],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(i?i[p]=n:this._root=n),this):(this._root=o,this)}function il(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function rl(){return this._root}function ol(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function sl(t){var e=[],n,i=this._root,r,o,s,a,l;for(i&&e.push(new X(i,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(i=n.node,o=n.x0,s=n.y0,a=n.x1,l=n.y1)&&i.length){var c=(o+a)/2,u=(s+l)/2;(r=i[3])&&e.push(new X(r,c,u,a,l)),(r=i[2])&&e.push(new X(r,o,u,c,l)),(r=i[1])&&e.push(new X(r,c,s,a,u)),(r=i[0])&&e.push(new X(r,o,s,c,u))}return this}function al(t){var e=[],n=[],i;for(this._root&&e.push(new X(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var o,s=i.x0,a=i.y0,l=i.x1,c=i.y1,u=(s+l)/2,f=(a+c)/2;(o=r[0])&&e.push(new X(o,s,a,u,f)),(o=r[1])&&e.push(new X(o,u,a,l,f)),(o=r[2])&&e.push(new X(o,s,f,u,c)),(o=r[3])&&e.push(new X(o,u,f,l,c))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function cl(t){return t[0]}function ll(t){return arguments.length?(this._x=t,this):this._x}function ul(t){return t[1]}function fl(t){return arguments.length?(this._y=t,this):this._y}function Sn(t,e,n){var i=new Nn(e??cl,n??ul,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function Nn(t,e,n,i,r,o){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=o,this._root=void 0}function ri(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Y=Sn.prototype=Nn.prototype;Y.copy=function(){var t=new Nn(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,i;if(!e)return t;if(!e.length)return t._root=ri(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?n.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=ri(i));return t};Y.add=Gc;Y.addAll=Jc;Y.cover=Qc;Y.data=Zc;Y.extent=tl;Y.find=el;Y.remove=nl;Y.removeAll=il;Y.root=rl;Y.size=ol;Y.visit=sl;Y.visitAfter=al;Y.x=ll;Y.y=fl;function Nt(t){return function(){return t}}function xt(t){return(t()-.5)*1e-6}function dl(t){return t.x+t.vx}function hl(t){return t.y+t.vy}function pl(t){var e,n,i,r=1,o=1;typeof t!="function"&&(t=Nt(t==null?1:+t));function s(){for(var c,u=e.length,f,d,h,x,w,m,p=0;p<o;++p)for(f=Sn(e,dl,hl).visitAfter(a),c=0;c<u;++c)d=e[c],w=n[d.index],m=w*w,h=d.x+d.vx,x=d.y+d.vy,f.visit(k);function k(S,y,b,E,I){var z=S.data,O=S.r,_=w+O;if(z){if(z.index>d.index){var C=h-z.x-z.vx,R=x-z.y-z.vy,$=C*C+R*R;$<_*_&&(C===0&&(C=xt(i),$+=C*C),R===0&&(R=xt(i),$+=R*R),$=(_-($=Math.sqrt($)))/$*r,d.vx+=(C*=$)*(_=(O*=O)/(m+O)),d.vy+=(R*=$)*_,z.vx-=C*(_=1-_),z.vy-=R*_)}return}return y>h+_||E<h-_||b>x+_||I<x-_}}function a(c){if(c.data)return c.r=n[c.data.index];for(var u=c.r=0;u<4;++u)c[u]&&c[u].r>c.r&&(c.r=c[u].r)}function l(){if(e){var c,u=e.length,f;for(n=new Array(u),c=0;c<u;++c)f=e[c],n[f.index]=+t(f,c,e)}}return s.initialize=function(c,u){e=c,i=u,l()},s.iterations=function(c){return arguments.length?(o=+c,s):o},s.strength=function(c){return arguments.length?(r=+c,s):r},s.radius=function(c){return arguments.length?(t=typeof c=="function"?c:Nt(+c),l(),s):t},s}function wl(t){return t.index}function oi(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function gl(t){var e=wl,n=f,i,r=Nt(30),o,s,a,l,c,u=1;t==null&&(t=[]);function f(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function d(m){for(var p=0,k=t.length;p<u;++p)for(var S=0,y,b,E,I,z,O,_;S<k;++S)y=t[S],b=y.source,E=y.target,I=E.x+E.vx-b.x-b.vx||xt(c),z=E.y+E.vy-b.y-b.vy||xt(c),O=Math.sqrt(I*I+z*z),O=(O-o[S])/O*m*i[S],I*=O,z*=O,E.vx-=I*(_=l[S]),E.vy-=z*_,b.vx+=I*(_=1-_),b.vy+=z*_}function h(){if(s){var m,p=s.length,k=t.length,S=new Map(s.map((b,E)=>[e(b,E,s),b])),y;for(m=0,a=new Array(p);m<k;++m)y=t[m],y.index=m,typeof y.source!="object"&&(y.source=oi(S,y.source)),typeof y.target!="object"&&(y.target=oi(S,y.target)),a[y.source.index]=(a[y.source.index]||0)+1,a[y.target.index]=(a[y.target.index]||0)+1;for(m=0,l=new Array(k);m<k;++m)y=t[m],l[m]=a[y.source.index]/(a[y.source.index]+a[y.target.index]);i=new Array(k),x(),o=new Array(k),w()}}function x(){if(s)for(var m=0,p=t.length;m<p;++m)i[m]=+n(t[m],m,t)}function w(){if(s)for(var m=0,p=t.length;m<p;++m)o[m]=+r(t[m],m,t)}return d.initialize=function(m,p){s=m,c=p,h()},d.links=function(m){return arguments.length?(t=m,h(),d):t},d.id=function(m){return arguments.length?(e=m,d):e},d.iterations=function(m){return arguments.length?(u=+m,d):u},d.strength=function(m){return arguments.length?(n=typeof m=="function"?m:Nt(+m),x(),d):n},d.distance=function(m){return arguments.length?(r=typeof m=="function"?m:Nt(+m),w(),d):r},d}const ml=1664525,yl=1013904223,si=4294967296;function xl(){let t=1;return()=>(t=(ml*t+yl)%si)/si}function vl(t){return t.x}function kl(t){return t.y}var _l=10,bl=Math.PI*(3-Math.sqrt(5));function Sl(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),o=0,s=.6,a=new Map,l=kn(f),c=Zt("tick","end"),u=xl();t==null&&(t=[]);function f(){d(),c.call("tick",e),n<i&&(l.stop(),c.call("end",e))}function d(w){var m,p=t.length,k;w===void 0&&(w=1);for(var S=0;S<w;++S)for(n+=(o-n)*r,a.forEach(function(y){y(n)}),m=0;m<p;++m)k=t[m],k.fx==null?k.x+=k.vx*=s:(k.x=k.fx,k.vx=0),k.fy==null?k.y+=k.vy*=s:(k.y=k.fy,k.vy=0);return e}function h(){for(var w=0,m=t.length,p;w<m;++w){if(p=t[w],p.index=w,p.fx!=null&&(p.x=p.fx),p.fy!=null&&(p.y=p.fy),isNaN(p.x)||isNaN(p.y)){var k=_l*Math.sqrt(.5+w),S=w*bl;p.x=k*Math.cos(S),p.y=k*Math.sin(S)}(isNaN(p.vx)||isNaN(p.vy))&&(p.vx=p.vy=0)}}function x(w){return w.initialize&&w.initialize(t,u),w}return h(),e={tick:d,restart:function(){return l.restart(f),e},stop:function(){return l.stop(),e},nodes:function(w){return arguments.length?(t=w,h(),a.forEach(x),e):t},alpha:function(w){return arguments.length?(n=+w,e):n},alphaMin:function(w){return arguments.length?(i=+w,e):i},alphaDecay:function(w){return arguments.length?(r=+w,e):+r},alphaTarget:function(w){return arguments.length?(o=+w,e):o},velocityDecay:function(w){return arguments.length?(s=1-w,e):1-s},randomSource:function(w){return arguments.length?(u=w,a.forEach(x),e):u},force:function(w,m){return arguments.length>1?(m==null?a.delete(w):a.set(w,x(m)),e):a.get(w)},find:function(w,m,p){var k=0,S=t.length,y,b,E,I,z;for(p==null?p=1/0:p*=p,k=0;k<S;++k)I=t[k],y=w-I.x,b=m-I.y,E=y*y+b*b,E<p&&(z=I,p=E);return z},on:function(w,m){return arguments.length>1?(c.on(w,m),e):c.on(w)}}}function Nl(){var t,e,n,i,r=Nt(-30),o,s=1,a=1/0,l=.81;function c(h){var x,w=t.length,m=Sn(t,vl,kl).visitAfter(f);for(i=h,x=0;x<w;++x)e=t[x],m.visit(d)}function u(){if(t){var h,x=t.length,w;for(o=new Array(x),h=0;h<x;++h)w=t[h],o[w.index]=+r(w,h,t)}}function f(h){var x=0,w,m,p=0,k,S,y;if(h.length){for(k=S=y=0;y<4;++y)(w=h[y])&&(m=Math.abs(w.value))&&(x+=w.value,p+=m,k+=m*w.x,S+=m*w.y);h.x=k/p,h.y=S/p}else{w=h,w.x=w.data.x,w.y=w.data.y;do x+=o[w.data.index];while(w=w.next)}h.value=x}function d(h,x,w,m){if(!h.value)return!0;var p=h.x-e.x,k=h.y-e.y,S=m-x,y=p*p+k*k;if(S*S/l<y)return y<a&&(p===0&&(p=xt(n),y+=p*p),k===0&&(k=xt(n),y+=k*k),y<s&&(y=Math.sqrt(s*y)),e.vx+=p*h.value*i/y,e.vy+=k*h.value*i/y),!0;if(h.length||y>=a)return;(h.data!==e||h.next)&&(p===0&&(p=xt(n),y+=p*p),k===0&&(k=xt(n),y+=k*k),y<s&&(y=Math.sqrt(s*y)));do h.data!==e&&(S=o[h.data.index]*i/y,e.vx+=p*S,e.vy+=k*S);while(h=h.next)}return c.initialize=function(h,x){t=h,n=x,u()},c.strength=function(h){return arguments.length?(r=typeof h=="function"?h:Nt(+h),u(),c):r},c.distanceMin=function(h){return arguments.length?(s=h*h,c):Math.sqrt(s)},c.distanceMax=function(h){return arguments.length?(a=h*h,c):Math.sqrt(a)},c.theta=function(h){return arguments.length?(l=h*h,c):Math.sqrt(l)},c}function Ml(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Ae(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Ft(t){return t=Ae(Math.abs(t)),t?t[1]:NaN}function Cl(t,e){return function(n,i){for(var r=n.length,o=[],s=0,a=t[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),o.push(n.substring(r-=a,r+a)),!((l+=a+1)>i));)a=t[s=(s+1)%t.length];return o.reverse().join(e)}}function El(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Tl=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ie(t){if(!(e=Tl.exec(t)))throw new Error("invalid format: "+t);var e;return new Mn({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Ie.prototype=Mn.prototype;function Mn(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Mn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Al(t){t:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break t;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var pr;function Il(t,e){var n=Ae(t,e);if(!n)return t+"";var i=n[0],r=n[1],o=r-(pr=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Ae(t,Math.max(0,e+o-1))[0]}function ai(t,e){var n=Ae(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const ci={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Ml,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>ai(t*100,e),r:ai,s:Il,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function li(t){return t}var ui=Array.prototype.map,fi=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function zl(t){var e=t.grouping===void 0||t.thousands===void 0?li:Cl(ui.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?li:El(ui.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function c(f){f=Ie(f);var d=f.fill,h=f.align,x=f.sign,w=f.symbol,m=f.zero,p=f.width,k=f.comma,S=f.precision,y=f.trim,b=f.type;b==="n"?(k=!0,b="g"):ci[b]||(S===void 0&&(S=12),y=!0,b="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var E=w==="$"?n:w==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",I=w==="$"?i:/[%p]/.test(b)?s:"",z=ci[b],O=/[defgprs%]/.test(b);S=S===void 0?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,S)):Math.max(0,Math.min(20,S));function _(C){var R=E,$=I,g,N,v;if(b==="c")$=z(C)+$,C="";else{C=+C;var M=C<0||1/C<0;if(C=isNaN(C)?l:z(Math.abs(C),S),y&&(C=Al(C)),M&&+C==0&&x!=="+"&&(M=!1),R=(M?x==="("?x:a:x==="-"||x==="("?"":x)+R,$=(b==="s"?fi[8+pr/3]:"")+$+(M&&x==="("?")":""),O){for(g=-1,N=C.length;++g<N;)if(v=C.charCodeAt(g),48>v||v>57){$=(v===46?r+C.slice(g+1):C.slice(g))+$,C=C.slice(0,g);break}}}k&&!m&&(C=e(C,1/0));var A=R.length+C.length+$.length,T=A<p?new Array(p-A+1).join(d):"";switch(k&&m&&(C=e(T+C,T.length?p-$.length:1/0),T=""),h){case"<":C=R+C+$+T;break;case"=":C=R+T+C+$;break;case"^":C=T.slice(0,A=T.length>>1)+R+C+$+T.slice(A);break;default:C=T+R+C+$;break}return o(C)}return _.toString=function(){return f+""},_}function u(f,d){var h=c((f=Ie(f),f.type="f",f)),x=Math.max(-8,Math.min(8,Math.floor(Ft(d)/3)))*3,w=Math.pow(10,-x),m=fi[8+x/3];return function(p){return h(w*p)+m}}return{format:c,formatPrefix:u}}var ce,wr,gr;Dl({thousands:",",grouping:[3],currency:["$",""]});function Dl(t){return ce=zl(t),wr=ce.format,gr=ce.formatPrefix,ce}function Ol(t){return Math.max(0,-Ft(Math.abs(t)))}function $l(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ft(e)/3)))*3-Ft(Math.abs(t)))}function Rl(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ft(e)-Ft(t))+1}function Ll(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Pl(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const di=Symbol("implicit");function Cn(){var t=new Bn,e=[],n=[],i=di;function r(o){let s=t.get(o);if(s===void 0){if(i!==di)return i;t.set(o,s=e.push(o)-1)}return n[s%n.length]}return r.domain=function(o){if(!arguments.length)return e.slice();e=[],t=new Bn;for(const s of o)t.has(s)||t.set(s,e.push(s)-1);return r},r.range=function(o){return arguments.length?(n=Array.from(o),r):n.slice()},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return Cn(e,n).unknown(i)},Ll.apply(r,arguments),r}function mr(t){return t}function Fl(t,e,n,i){var r=xo(t,e,n),o;switch(i=Ie(i??",f"),i.type){case"s":{var s=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(o=$l(r,s))&&(i.precision=o),gr(i,s)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=Rl(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=Ol(r))&&(i.precision=o-(i.type==="%")*2);break}}return wr(i)}function Bl(t){var e=t.domain;return t.ticks=function(n){var i=e();return yo(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return Fl(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,o=i.length-1,s=i[r],a=i[o],l,c,u=10;for(a<s&&(c=s,s=a,a=c,c=r,r=o,o=c);u-- >0;){if(c=tn(s,a,n),c===l)return i[r]=s,i[o]=a,e(i);if(c>0)s=Math.floor(s/c)*c,a=Math.ceil(a/c)*c;else if(c<0)s=Math.ceil(s*c)/c,a=Math.floor(a*c)/c;else break;l=c}return t},t}function ql(){var t=0,e=1,n,i,r,o,s=mr,a=!1,l;function c(f){return f==null||isNaN(f=+f)?l:s(r===0?.5:(f=(o(f)-n)*r,a?Math.max(0,Math.min(1,f)):f))}c.domain=function(f){return arguments.length?([t,e]=f,n=o(t=+t),i=o(e=+e),r=n===i?0:1/(i-n),c):[t,e]},c.clamp=function(f){return arguments.length?(a=!!f,c):a},c.interpolator=function(f){return arguments.length?(s=f,c):s};function u(f){return function(d){var h,x;return arguments.length?([h,x]=d,s=f(h,x),c):[s(0),s(1)]}}return c.range=u(xn),c.rangeRound=u(Ta),c.unknown=function(f){return arguments.length?(l=f,c):l},function(f){return o=f,n=f(t),i=f(e),r=n===i?0:1/(i-n),c}}function Hl(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function ht(){var t=Bl(ql()(mr));return t.copy=function(){return Hl(t,ht())},Pl.apply(t,arguments)}function Xl(t){for(var e=t.length/6|0,n=new Array(e),i=0;i<e;)n[i]="#"+t.slice(i*6,++i*6);return n}const yr=Xl("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),le=t=>()=>t;function Yl(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function pt(t,e,n){this.k=t,this.x=e,this.y=n}pt.prototype={constructor:pt,scale:function(t){return t===1?this:new pt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new pt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var xr=new pt(1,0,0);pt.prototype;function Ue(t){t.stopImmediatePropagation()}function Ht(t){t.preventDefault(),t.stopImmediatePropagation()}function Ul(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Kl(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function hi(){return this.__zoom||xr}function jl(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Vl(){return navigator.maxTouchPoints||"ontouchstart"in this}function Wl(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function Gl(){var t=Ul,e=Kl,n=Wl,i=jl,r=Vl,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=La,c=Zt("start","zoom","end"),u,f,d,h=500,x=150,w=0,m=10;function p(g){g.property("__zoom",hi).on("wheel.zoom",z,{passive:!1}).on("mousedown.zoom",O).on("dblclick.zoom",_).filter(r).on("touchstart.zoom",C).on("touchmove.zoom",R).on("touchend.zoom touchcancel.zoom",$).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}p.transform=function(g,N,v,M){var A=g.selection?g.selection():g;A.property("__zoom",hi),g!==A?b(g,N,v,M):A.interrupt().each(function(){E(this,arguments).event(M).start().zoom(null,typeof N=="function"?N.apply(this,arguments):N).end()})},p.scaleBy=function(g,N,v,M){p.scaleTo(g,function(){var A=this.__zoom.k,T=typeof N=="function"?N.apply(this,arguments):N;return A*T},v,M)},p.scaleTo=function(g,N,v,M){p.transform(g,function(){var A=e.apply(this,arguments),T=this.__zoom,D=v==null?y(A):typeof v=="function"?v.apply(this,arguments):v,L=T.invert(D),F=typeof N=="function"?N.apply(this,arguments):N;return n(S(k(T,F),D,L),A,s)},v,M)},p.translateBy=function(g,N,v,M){p.transform(g,function(){return n(this.__zoom.translate(typeof N=="function"?N.apply(this,arguments):N,typeof v=="function"?v.apply(this,arguments):v),e.apply(this,arguments),s)},null,M)},p.translateTo=function(g,N,v,M,A){p.transform(g,function(){var T=e.apply(this,arguments),D=this.__zoom,L=M==null?y(T):typeof M=="function"?M.apply(this,arguments):M;return n(xr.translate(L[0],L[1]).scale(D.k).translate(typeof N=="function"?-N.apply(this,arguments):-N,typeof v=="function"?-v.apply(this,arguments):-v),T,s)},M,A)};function k(g,N){return N=Math.max(o[0],Math.min(o[1],N)),N===g.k?g:new pt(N,g.x,g.y)}function S(g,N,v){var M=N[0]-v[0]*g.k,A=N[1]-v[1]*g.k;return M===g.x&&A===g.y?g:new pt(g.k,M,A)}function y(g){return[(+g[0][0]+ +g[1][0])/2,(+g[0][1]+ +g[1][1])/2]}function b(g,N,v,M){g.on("start.zoom",function(){E(this,arguments).event(M).start()}).on("interrupt.zoom end.zoom",function(){E(this,arguments).event(M).end()}).tween("zoom",function(){var A=this,T=arguments,D=E(A,T).event(M),L=e.apply(A,T),F=v==null?y(L):typeof v=="function"?v.apply(A,T):v,it=Math.max(L[1][0]-L[0][0],L[1][1]-L[0][1]),q=A.__zoom,J=typeof N=="function"?N.apply(A,T):N,ct=l(q.invert(F).concat(it/q.k),J.invert(F).concat(it/J.k));return function(Q){if(Q===1)Q=J;else{var lt=ct(Q),qe=it/lt[2];Q=new pt(qe,F[0]-lt[0]*qe,F[1]-lt[1]*qe)}D.zoom(null,Q)}})}function E(g,N,v){return!v&&g.__zooming||new I(g,N)}function I(g,N){this.that=g,this.args=N,this.active=0,this.sourceEvent=null,this.extent=e.apply(g,N),this.taps=0}I.prototype={event:function(g){return g&&(this.sourceEvent=g),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(g,N){return this.mouse&&g!=="mouse"&&(this.mouse[1]=N.invert(this.mouse[0])),this.touch0&&g!=="touch"&&(this.touch0[1]=N.invert(this.touch0[0])),this.touch1&&g!=="touch"&&(this.touch1[1]=N.invert(this.touch1[0])),this.that.__zoom=N,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(g){var N=ot(this.that).datum();c.call(g,this.that,new Yl(g,{sourceEvent:this.sourceEvent,target:p,type:g,transform:this.that.__zoom,dispatch:c}),N)}};function z(g,...N){if(!t.apply(this,arguments))return;var v=E(this,N).event(g),M=this.__zoom,A=Math.max(o[0],Math.min(o[1],M.k*Math.pow(2,i.apply(this,arguments)))),T=ft(g);if(v.wheel)(v.mouse[0][0]!==T[0]||v.mouse[0][1]!==T[1])&&(v.mouse[1]=M.invert(v.mouse[0]=T)),clearTimeout(v.wheel);else{if(M.k===A)return;v.mouse=[T,M.invert(T)],ge(this),v.start()}Ht(g),v.wheel=setTimeout(D,x),v.zoom("mouse",n(S(k(M,A),v.mouse[0],v.mouse[1]),v.extent,s));function D(){v.wheel=null,v.end()}}function O(g,...N){if(d||!t.apply(this,arguments))return;var v=g.currentTarget,M=E(this,N,!0).event(g),A=ot(g.view).on("mousemove.zoom",F,!0).on("mouseup.zoom",it,!0),T=ft(g,v),D=g.clientX,L=g.clientY;Zi(g.view),Ue(g),M.mouse=[T,this.__zoom.invert(T)],ge(this),M.start();function F(q){if(Ht(q),!M.moved){var J=q.clientX-D,ct=q.clientY-L;M.moved=J*J+ct*ct>w}M.event(q).zoom("mouse",n(S(M.that.__zoom,M.mouse[0]=ft(q,v),M.mouse[1]),M.extent,s))}function it(q){A.on("mousemove.zoom mouseup.zoom",null),tr(q.view,M.moved),Ht(q),M.event(q).end()}}function _(g,...N){if(t.apply(this,arguments)){var v=this.__zoom,M=ft(g.changedTouches?g.changedTouches[0]:g,this),A=v.invert(M),T=v.k*(g.shiftKey?.5:2),D=n(S(k(v,T),M,A),e.apply(this,N),s);Ht(g),a>0?ot(this).transition().duration(a).call(b,D,M,g):ot(this).call(p.transform,D,M,g)}}function C(g,...N){if(t.apply(this,arguments)){var v=g.touches,M=v.length,A=E(this,N,g.changedTouches.length===M).event(g),T,D,L,F;for(Ue(g),D=0;D<M;++D)L=v[D],F=ft(L,this),F=[F,this.__zoom.invert(F),L.identifier],A.touch0?!A.touch1&&A.touch0[2]!==F[2]&&(A.touch1=F,A.taps=0):(A.touch0=F,T=!0,A.taps=1+!!u);u&&(u=clearTimeout(u)),T&&(A.taps<2&&(f=F[0],u=setTimeout(function(){u=null},h)),ge(this),A.start())}}function R(g,...N){if(this.__zooming){var v=E(this,N).event(g),M=g.changedTouches,A=M.length,T,D,L,F;for(Ht(g),T=0;T<A;++T)D=M[T],L=ft(D,this),v.touch0&&v.touch0[2]===D.identifier?v.touch0[0]=L:v.touch1&&v.touch1[2]===D.identifier&&(v.touch1[0]=L);if(D=v.that.__zoom,v.touch1){var it=v.touch0[0],q=v.touch0[1],J=v.touch1[0],ct=v.touch1[1],Q=(Q=J[0]-it[0])*Q+(Q=J[1]-it[1])*Q,lt=(lt=ct[0]-q[0])*lt+(lt=ct[1]-q[1])*lt;D=k(D,Math.sqrt(Q/lt)),L=[(it[0]+J[0])/2,(it[1]+J[1])/2],F=[(q[0]+ct[0])/2,(q[1]+ct[1])/2]}else if(v.touch0)L=v.touch0[0],F=v.touch0[1];else return;v.zoom("touch",n(S(D,L,F),v.extent,s))}}function $(g,...N){if(this.__zooming){var v=E(this,N).event(g),M=g.changedTouches,A=M.length,T,D;for(Ue(g),d&&clearTimeout(d),d=setTimeout(function(){d=null},h),T=0;T<A;++T)D=M[T],v.touch0&&v.touch0[2]===D.identifier?delete v.touch0:v.touch1&&v.touch1[2]===D.identifier&&delete v.touch1;if(v.touch1&&!v.touch0&&(v.touch0=v.touch1,delete v.touch1),v.touch0)v.touch0[1]=this.__zoom.invert(v.touch0[0]);else if(v.end(),v.taps===2&&(D=ft(D,this),Math.hypot(f[0]-D[0],f[1]-D[1])<m)){var L=ot(this).on("dblclick.zoom");L&&L.apply(this,arguments)}}}return p.wheelDelta=function(g){return arguments.length?(i=typeof g=="function"?g:le(+g),p):i},p.filter=function(g){return arguments.length?(t=typeof g=="function"?g:le(!!g),p):t},p.touchable=function(g){return arguments.length?(r=typeof g=="function"?g:le(!!g),p):r},p.extent=function(g){return arguments.length?(e=typeof g=="function"?g:le([[+g[0][0],+g[0][1]],[+g[1][0],+g[1][1]]]),p):e},p.scaleExtent=function(g){return arguments.length?(o[0]=+g[0],o[1]=+g[1],p):[o[0],o[1]]},p.translateExtent=function(g){return arguments.length?(s[0][0]=+g[0][0],s[1][0]=+g[1][0],s[0][1]=+g[0][1],s[1][1]=+g[1][1],p):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},p.constrain=function(g){return arguments.length?(n=g,p):n},p.duration=function(g){return arguments.length?(a=+g,p):a},p.interpolate=function(g){return arguments.length?(l=g,p):l},p.on=function(){var g=c.on.apply(c,arguments);return g===c?p:g},p.clickDistance=function(g){return arguments.length?(w=(g=+g)*g,p):Math.sqrt(w)},p.tapDistance=function(g){return arguments.length?(m=+g,p):m},p}function vr(){window.spwashi.links.length=0}function Jl(t){window.spwashi.links=window.spwashi.links.filter(e=>e.source!==t&&e.target!==t)}function oh(t){window.spwashi.links=window.spwashi.links.filter(e=>t.includes(e.source)&&t.includes(e.target))}function kr(t){return t.sort((e,n)=>e.z-n.z)}function Rt(t,e){const i=document.querySelector("#main-log").querySelector(".events-log");if(!i)return;const r=document.createElement("li");i.appendChild(r);const o=document.createElement("details");r.appendChild(o);const s=document.createElement("summary");if(o.appendChild(s),s.innerText=t,e){const a=document.createElement("pre");a.innerText=e,o.appendChild(a)}}function Ql(t){const e=(n,i)=>{var o,s,a;if(Ge.push(i),Rt("clicked: "+i.id,JSON.stringify(i,null,3)),(s=(o=i.callbacks)==null?void 0:o.click)==null||s.call(o,n,i),n.defaultPrevented)return;let r=window.spwashi.superpower.intent;if(n.key==="x"){i.fx=isNaN(i.fx)?i.x:i.fx;return}if(n.key==="y"){i.fy=isNaN(i.fy)?i.y:i.fy;return}if(n.shiftKey){i.fx=i.fy=void 0;return}if(!(n.key&&n.key!==" ")){switch(n.shiftKey&&(r*=-1),console.log(i),window.spwashi.superpower.name){case"hyperlink":const l=i.url||((a=i.getUrl)==null?void 0:a.call(i));if(i.url=l,!l)break;Rt("hyperlink: "+l);break;case"prune":window.spwashi.nodes.splice(window.spwashi.nodes.indexOf(i),1),Jl(i),window.spwashi.reinit();break;case"alert":if(!i.md5)return;navigator.clipboard.writeText(i.md5).then(c=>{alert(i.md5)});break;case"grow":{i.r+=r;break}case"shrink":{i.r-=r;break}case"colorindex":{i.color=void 0,isNaN(i.colorindex)&&(i.colorindex=1),i.colorindex+=r;break}case"z":{i.z=i.z||0,i.z+=r,kr(B());break}}Kt()}};return t.append("circle").attr("data-colorindex",n=>"spwashi-datum-"+n.colorindex).attr("r",n=>n.r||1).attr("fill",n=>n.color||void 0).attr("cx",n=>n.x||0).attr("cy",n=>n.y||0).call(Re().on("start",(n,i)=>{i.x=n.x,i.y=n.y,i.ondrag=i.callbacks.ondrag||(()=>{})}).on("drag",(n,i)=>{i.fx=n.x,i.fy=n.y,i.ondrag(n,i)}).on("end",(n,i)=>{window.spwashi.tick(),delete i.ondrag,Kt()})).on("click",e).on("keydown",(n,i)=>{e(n,i)})}function Zl(t){t.select("circle").attr("stroke",e=>e.stroke).attr("stroke-width",e=>e.strokeWidth||5).attr("fill",e=>e.color||void 0).attr("data-colorindex",e=>e.color?void 0:"spwashi-datum-"+e.colorindex%13).attr("cx",e=>e.x||0).attr("r",e=>e.r||1).attr("cy",e=>e.y||0)}function tu(t){const e=t.append("a");e.attr("href",i=>i.url||void 0),e.attr("target",i=>"_blank");const n=e.append("text");return n.attr("x",i=>i.x).attr("font-size",i=>i.text.fontSize||i.r).call(Re().on("start",(i,r)=>{r.text.fx=r.text.fx||0,r.text.fy=r.text.fy||0,Rt("clicked: "+r.id,JSON.stringify(r,null,3))}).on("drag",(i,r)=>{r.fx=i.x,r.fy=i.y}).on("end",(i,r)=>{})),n.selectAll("tspan").data(i=>Ze(i).split(`
`).map((r,o)=>({node:i,i:o,text:r}))).join(i=>i.append("tspan").attr("text-anchor","middle").attr("dy",r=>r.node.r*2).attr("dx",0),i=>i.selectAll("tspan").text(r=>r.text),i=>i.selectAll("tspan").remove()),t}function eu(t){const e=t.select("a");return e.attr("href",i=>i.url||void 0),e.select("text").attr("x",i=>(i.x||0)+(i.text.fx||0)).attr("y",i=>(i.y||0)+(i.text.fy||0)-Ze(i).split(`
`).length*i.r/2).attr("font-size",i=>i.text.fontSize||i.r).selectAll("tspan").data(i=>Ze(i).split(`
`).map((r,o)=>({node:i,i:o,text:r}))).text(i=>i.text).attr("fill",i=>i.node.text.color||void 0).attr("x",i=>(i.node.x||0)+(i.node.text.fx||0)),t}function nu(t){return t.append("rect")}function iu(t){return t.append("rect").attr("width",e=>window.spwashi.getNodeImageHref(e)?e.image.r||e.r:0).attr("height",e=>window.spwashi.getNodeImageHref(e)?e.image.r||e.r:0).attr("x",e=>e.x+e.image.offsetX-e.image.r/2).attr("y",e=>e.y+e.image.offsetY-e.image.r/2),t.append("image").attr("href",window.spwashi.getNodeImageHref).attr("width",e=>e.image.r||e.r).attr("height",e=>e.image.r||e.r).attr("preserveAspectRatio",e=>"xMidYMin slice").attr("x",e=>e.x+e.image.offsetX).attr("y",e=>e.y+e.image.offsetY).attr("stroke",Bi).attr("stroke-width",2).call(Re().on("start",(e,n)=>{}).on("drag",(e,n)=>{n.image.offsetX+=e.dx,n.image.offsetY+=e.dy}).on("end",(e,n)=>{Kt()})).on("error",(e,n)=>{n.image.href=null,n.image.r=0}).on("click",(e,n)=>{if(event.defaultPrevented)return;let i=window.spwashi.superpower.intent;switch(e.shiftKey&&(i*=-1),window.spwashi.superpower.name){case"grow":{n.image.r=n.image.r||n.r,n.image.r+=i;break}case"shrink":{n.image.r=n.image.r||n.r,n.image.r-=i;break}case"colorindex":{isNaN(n.colorindex)&&(n.colorindex=1),n.colorindex+=i;break}}Kt()}),t}function ru(t){t.select("rect").attr("stroke","black").attr("x",e=>e.x+e.image.offsetX-e.image.r/2).attr("y",e=>e.y+e.image.offsetY-e.image.r/2).attr("width",e=>window.spwashi.getNodeImageHref(e)?e.image.r:0).attr("height",e=>window.spwashi.getNodeImageHref(e)?e.image.r:0),t.select("image").attr("href",window.spwashi.getNodeImageHref).attr("width",e=>e.image.r).attr("height",e=>e.image.r).attr("x",e=>e.x+e.image.offsetX-e.image.r/2).attr("y",e=>e.y+e.image.offsetY-e.image.r/2)}function ou(t){window.spwashi.nodes=t}function En(){window.spwashi.nodes=[]}function sh(t){window.spwashi.nodes=window.spwashi.nodes.filter(t)}function su(){window.spwashi.nodes=window.spwashi.nodes.filter(t=>t.kind!=="__cluster"),window.spwashi.links=window.spwashi.links.filter(t=>t.source.kind!=="__cluster"&&t.target.kind!=="__cluster")}function ah(t){window.spwashi.nodes.length=Math.max(0,window.spwashi.nodes.length-t)}function au(t,e,n){const i={image:{},callbacks:{},charge:0,parts:{},private:{},text:{fontSize:20},r:1*window.spwashi.parameters.nodes.radiusMultiplier,z:0,x:window.spwashi.parameters.startPos.x+n*2,y:window.spwashi.parameters.startPos.y,colorindex:kt()};return Object.assign(t,i,e,{name:t.identity||"node:"+n,idx:n},{...t}),t.r=Math.max(t.r,1),t.image.r=isNaN(t.image.r)?t.r:Math.max(10,t.image.r),t.image.offsetX=isNaN(t.image.offsetX)?0:t.image.offsetX,t.image.offsetY=isNaN(t.image.offsetY)?t.r:t.image.offsetY,t}function cu(t,e=void 0){let n;return B().find(r=>{if(r.identity===t)return n=n||r,e===void 0?!0:r.colorindex===e;r.id===t&&(n=n||r)})||n}const pi=new Map;function lu(t={},e=0){return t.identity?t.identity:`node:[${e}]`}function uu(t,e){const n=lu(t,e),i=pi.get(n)||new Set;return i.has(t)||(t.id=n+(i.size?"["+i.size+"]":""),i.add(t)),t.id=t.id||n,pi.set(t.id,i),t.id}function fu(t){return!0}const G={getNode:cu,initNodes:du,normalize:au,updateNodes:hu,filterNode:fu,processNode:Bt,cacheNode:Kt};function du(t){const e=t.length;for(let i=0;i<e;i++){const r={id:uu(t[i],i)},o=lo(r);G.normalize(t[i],{...r,...o},i)}const n=kr(t);return ou(n),n}function hu(t,e){const n=t.select(".nodes").selectAll("g.wrapper").data(e,s=>s.id),i=s=>{const a=s.append("g").classed("wrapper",!0),l=a.append("g").classed("image",!0),c=a.append("g").classed("node",!0),u=a.append("g").classed("text",!0);return iu(l),Ql(c),nu(c),tu(u),a},r=s=>{const a=s.select("g.node"),l=s.select("g.image"),c=s.select("g.text");return Zl(a),eu(c),ru(l),a.select("rect").attr("stroke-width","1px").attr("fill",uo).attr("stroke",Bi).attr("fill","none").attr("x",u=>u.x-u.r).attr("y",u=>u.y-u.r),s},o=s=>{s.select("g.node").remove(),s.select("g.text").remove(),s.select("g.image").remove()};n.join(i,r,o)}function pu(){const t=B();H(G.cacheNode),window.spwashi.setItem("parameters.nodes-input",t),window.spwashi.setItem("parameters.nodes-input-map-fn-string","data => data"),window.spwashi.refreshNodeInputs()}function wu(){pu()}function wi(){H(t=>{t.fx=t.fy=void 0})}function gu(){H(t=>{t.fx=t.x,t.fy=t.y})}function vt(t,...e){return t.push(...e),t}function mu(t){return"cluster:"+t.colorindex}function yu(t){const e=B().reduce((n,i)=>{const r=mu(i);return n[r]=n[r]||[],n[r].push(i),n},{});su(),Object.entries(e).forEach(([n,i])=>{const r={identity:n,kind:"__cluster",r:100};j(r),i.forEach(o=>{vt(window.spwashi.links,{source:r,target:o,strength:1})})}),t.physicsChange=!0}const xu="hotkey-menu",Tn="standard",An="minimalism",vu="main-menu";function In(t){let e;if(t){const n=t.indexOf(document.body.dataset.interfaceDepth),i=t.filter((r,o)=>o!==n);e=i[n+1]||i[0]}else window.spwashi.minimalism?e=An:e=Tn;document.body.dataset.interfaceDepth=e}function ku(){{window.spwashi.minimalism=!0,In(),document.body.dataset.displaymode="nodes";return}}function _u(t){H(e=>{e.x=Math.random()*1e3,e.y=Math.random()*1e3}),t.physicsChange=!0}function bu(t){const e=B();e.forEach((n,i)=>{const r=e[i],o=e[(i+1)%e.length];vt(window.spwashi.links,{source:r,target:o,strength:.1})}),t.physicsChange=!0}function Su(){{window.spwashi.bone();return}}function Nu(){H(t=>{t.stroke="grey"})}const Mu={"@node":(t,e)=>Cu(t,e)};function Cu(t,e){const n=window.spwashi.parameters.width*.9/e;return{name:"#",kind:"__boon",r:50,fx:n*t+n*(e-1)/e,fy:window.spwashi.parameters.height/2,color:"turquoise",stroke:"#ffffff",strokeWidth:1,colorindex:kt()}}function Eu(){{window.spwashi.boon();return}}function Tu(){{window.spwashi.honk();return}}function Au(){{window.spwashi.bonk();return}}function Iu(t){const e=document.querySelector("title").innerText;t.nextDocumentMode="spw",t.valueStrings.push(`${e}`)}function zu(){{const t=new URLSearchParams;t.set("display","nodes"),Qt(t)}}function Du(){{window.spwashi.setItem("parameters.page-image",""),hn();return}}function Ou(){En(),vr(),window.spwashi.reinit()}const $u="modulepreload",Ru=function(t){return"/"+t},gi={},zn=function(e,n,i){if(!n||n.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(n.map(o=>{if(o=Ru(o),o in gi)return;gi[o]=!0;const s=o.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(!!i)for(let u=r.length-1;u>=0;u--){const f=r[u];if(f.href===o&&(!s||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${a}`))return;const c=document.createElement("link");if(c.rel=s?"stylesheet":$u,s||(c.as="script",c.crossOrigin=""),c.href=o,document.head.appendChild(c),s)return new Promise((u,f)=>{c.addEventListener("load",u),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e()).catch(o=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o})};function Lu(){const t=document.querySelector("#mainmenu-toggle");t&&(t.onclick=()=>In([vu,window.spwashi.minimalism?An:Tn]))}function Pu(){In([xu,window.spwashi.minimalism?An:Tn])}function Fu(){const t=document.querySelector("#keystroke-options");if(!t){window.spwashi.callbacks.acknowledgeLonging("wondering about keystroke options");return}t.innerHTML="";const e=document.querySelector("#hotkey-menu-toggle");e.onclick=i=>{Pu()};const n=t.appendChild(document.createElement("UL"));window.spwashi.keystrokeOptions.filter(i=>i.revealOrder<=window.spwashi.keystrokeRevealOrder).forEach(({shortcut:i,categories:r=[],title:o,callback:s,shortcutName:a})=>{const l=()=>{s()},c=n.appendChild(document.createElement("LI"));if(!o)return;const u=c.appendChild(document.createElement("SPAN"));u.className="ctg",u.innerHTML=r.map(h=>`<span>[${h}]</span>`).join("");const f=c.appendChild(document.createElement("BUTTON"));f.onclick=l,f.innerHTML=o;const d=c.appendChild(document.createElement("KBD"));d.innerHTML=`ctrl + <strong>${a||i}</strong>`})}function ch(t){return{identity:t.identity,name:t.name,x:t.x,y:t.y,fx:t.fx,fy:t.fy,r:t.r,id:t.id,image:t.image.href?t.image:void 0,md5:t.md5,colorindex:t.colorindex}}function _r(t){const e=JSON.parse(t);return Array.isArray(e)?{nodes:e||[],links:[]}:e.nodes&&Array.isArray(e.nodes)?{nodes:e.nodes,links:e.links||[]}:(console.error("not nodes"),{nodes:[],links:[]})}function Bu(){window.spwashi.refreshNodeInputs=n=>{const i=document.querySelector("#nodes-input");if(!i){window.spwashi.callbacks.acknowledgeLonging("wondering about nodes input");return}const r=window.spwashi.getItem("parameters.nodes-input")||[];i.value=JSON.stringify(r)},window.spwashi.readNodeInputs=()=>{var i;const n=(i=document.querySelector("#nodes-input"))==null?void 0:i.value;return n?_r(n):(window.spwashi.setItem("parameters.nodes-input",null),console.log("no input"),{nodes:[],links:[]})},window.spwashi.refreshNodeInputs(),j(...window.spwashi.readNodeInputs().nodes.filter(G.filterNode)),H(Bt),window.spwashi.reinit();const t=document.querySelector("#nodes-input");if(!t){window.spwashi.callbacks.acknowledgeLonging("wondering about nodes input");return}t.onfocus=()=>t.select();const e=(n=!0)=>{const i=window.spwashi.readNodeInputs().nodes;n||(En(),window.spwashi.reinit()),j(...i),window.spwashi.reinit(),K("")};document.querySelector("#controls button.read-nodes").onclick=()=>e(!0),document.querySelector("#node-input-container button.add").onclick=()=>e(!0),document.querySelector("#node-input-container button.replace").onclick=()=>e(!1),document.querySelector("#controls button.save-nodes").onclick=()=>{const n=B();n.map(G.cacheNode),window.spwashi.setItem("parameters.nodes-input",n),window.spwashi.refreshNodeInputs()},document.querySelector("#controls button.clear-saved-nodes").onclick=()=>{const n=B();n.map(i=>{const r=i.id;for(let o in i)delete i[o];i.id=r,G.cacheNode(i)}),n.length=0,window.spwashi.reinit(),K("")}}function br(t){const e=[],n=window.spwashi.parameters.links.strength;let i=!1;for(let r of t){if(!(r.identity&&r.parts))continue;const{head:o,body:s,tail:a}=r.parts;[o,s,a].flat().map(c=>c==null?void 0:c.identity).filter(Boolean).forEach(c=>{const u=typeof c=="string"?c:c.identity,f=!!window.spwashi.parameters.perspective,d=window.spwashi.getNode(u,f?r.colorindex:void 0);if(!d){i=!0;return}let h=1;switch(d.kind.trim()){case"operator + delimiter + essential.open":case"operator + delimiter + essential.close":h=5;break;case"operator + delimiter + locational.open":case"operator + delimiter + locational.close":h=5;break;case"operator + delimiter + conceptual.open":case"operator + delimiter + conceptual.close":h=5;break}switch(r.kind.trim()){case"phrasal":h=7;break}const x=n*h,w={source:d.id,target:r.id,strength:x};vt(e,w)})}return i&&console.error(t),e}function qu(t){return vt(window.spwashi.links,...br(t))}function Hu(t,e){t.select(".links").selectAll("line").data(e).join(n=>n.append("line").attr("stroke-width",i=>(i.strength||1)*13).attr("x1",i=>i.source.x).attr("y1",i=>i.source.y).attr("x2",i=>i.target.x).attr("y2",i=>i.target.y),n=>n.attr("x1",i=>i.source.x).attr("stroke-width",i=>(i.strength||1)*13).attr("data-colorindex",i=>"spwashi-stroke-"+i.colorindex).attr("y1",i=>i.source.y).attr("x2",i=>i.target.x).attr("y2",i=>i.target.y),n=>n.remove())}const Xu={initLinks:qu,updateLinks:Hu};function Sr(t){const e=_r(t);if(e.nodes.length===0)return!1;const n=e.nodes.filter(G.filterNode);n.forEach(G.processNode),j(...n);const i=Xu.initLinks(e.links,n);vt(window.spwashi.links,...i),window.spwashi.reinit()}function Yu(t){window.spwashi.keystrokeOptions=t}function Nr(){Lu(),window.spwashi.keystrokeRevealOrder=window.spwashi.keystrokeRevealOrder||0;function t(e,n){const i=window.spwashi.modeOrder.map((o,s)=>[s+1,()=>K(o,!0,!0)]),r=Object.fromEntries(i);if(!["INPUT","TEXTAREA"].includes(document.activeElement.tagName)){if(e==="/"){n.preventDefault(),document.querySelector("h1").click();return}if(r[e]){n&&n.preventDefault(),r[e]();return}switch(e){case"ArrowRight":window.spwashi.callbacks.arrowRight();break;case"ArrowLeft":window.spwashi.callbacks.arrowLeft();break;case"ArrowUp":window.spwashi.callbacks.arrowUp();break;case"ArrowDown":window.spwashi.callbacks.arrowDown();break}}}document.addEventListener("paste",e=>{if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA")return;const i=(e.clipboardData||window.clipboardData).getData("Text");return Sr(i)}),document.addEventListener("keydown",e=>{const n=e.key;if(n==="Escape"&&(document.querySelector("#mode-container :is(:focus)"),K("")),!e.shiftKey){if(e.metaKey||e.ctrlKey){for(let i of window.spwashi.keystrokeOptions)n===i.shortcut&&(e.preventDefault(),i.callback());return}t(n,e)}}),zn(()=>import("./keystrokes-vZAoZ81c.js"),__vite__mapDeps([])).then(({initialKeyStrokeOptions:e})=>{window.spwashi.keystrokeOptions=e,Fu(),Yu(e)})}const Mr="extended menu".trim();function Uu(){window.spwashi.keystrokeRevealOrder=1,Nr()}function Ku(){return window.spwashi.parameters.forces.alpha}function ju(){return window.spwashi.parameters.forces.alphaTarget}function Vu(){return window.spwashi.parameters.forces.alphaDecay}function Wu(){return window.spwashi.parameters.forces.velocityDecay}function Gu(){const t=window.spwashi.simulation,e=window.spwashi.links,n=B();t.alpha(Ku()),t.alphaTarget(ju()),t.alphaDecay(Vu()),t.velocityDecay(Wu()),t.force("link",gl().links(e).id(i=>i.id).strength(i=>i.strength||1)),t.force("collide",pl(i=>i.collisionRadius||i.r)),t.force("charge",null),t.force("charge",Nl().strength(i=>i.charge||window.spwashi.parameters.forces.charge)),t.force("center",Wc(window.spwashi.parameters.forces.centerPos.x,window.spwashi.parameters.forces.centerPos.y).strength(window.spwashi.parameters.forces.centerStrength)),t.force("boundingBox",null),window.spwashi.parameters.forces.boundingBox&&t.force("boundingBox",i=>{for(let r=0,o=n.length,s=i*.1;r<o;++r){const a=n[r];a.x>window.spwashi.parameters.width?(a.x=window.spwashi.parameters.width,a.vx*=.9):a.x<0&&(a.x=0,a.vx*=.9),a.y>window.spwashi.parameters.height?(a.y=window.spwashi.parameters.height,a.vy*=.9):a.y<0&&(a.y=0,a.vy*=.9)}})}function Ju(t){Gu(),t.physicsChange=!0}function Qu(t){const e=t.valueStrings[0];H(n=>n.collisionRadius=parseInt(e)),t.physicsChange=!0}function Zu(t){window.location.href="/_spwashi@",t.valueStrings.push("https://spwashi.com","https://lore.land","https://boon.land","https://bane.land","https://bone.land","https://bonk.land","https://honk.land","https://boof.land","https://factshift.com"),t.nextDocumentMode="spw"}function tf(t){const e=B(),n=[Cn(yr),ht([0,e.length],i=>`hsl(${i*360}, 100%, 50%)`)][1];e.forEach((i,r)=>{i.color=n(r)})}function ef(t){const e=B(),n=window.spwashi.parameters.width,i=window.spwashi.parameters.height;e.forEach((r,o)=>{r.x=o%5*n/5,r.y=Math.floor(o/5)*i/5}),t.nodesImpacted=e,t.physicsChange=!0}function nf(){B().forEach(t=>{t.x=Math.random()*window.spwashi.parameters.width,t.y=Math.random()*window.spwashi.parameters.height})}const rf=t=>{t.valueStrings.push(...Object.keys(un).filter(e=>!["options","clear","save","home","help"].includes(e)).map(e=>e+`
`)),t.nextDocumentMode="spw"},un={home:()=>Qr(),clear:()=>Ou(),save:()=>wu(),freeze:()=>gu(),unfreeze:()=>wi(),unfix:()=>wi(),prune:()=>nf(),help:t=>Jr(t),spwashi:t=>Zu(t),color:t=>tf(),forces:t=>Ju(t),cr:t=>Qu(t),all:t=>to(t),clicked:t=>eo(t),cluster:t=>yu(t),scatter:t=>_u(t),arrange:t=>ef(t),demo:t=>Zr(t),link:t=>bu(t),title:t=>Iu(t),minimalism:()=>ku(),boon:()=>Eu(),bane:()=>Nu(),bone:()=>Su(),honk:()=>Tu(),bonk:()=>Au(),nodesonly:()=>zu(),noimage:()=>Du(),[Mr]:()=>Uu(),options:rf};function of(t,e){t.valueStrings.push(e),t.liveStrings.push(e)}function sf(t,e){return un[t]?un[t](e):of(e,t)}const af={regex:/^add=(-?\d+)/,handler:(t,e)=>{const n=parseInt(e),i=[...Array(n)].map((r,o)=>({name:o+"",fy:.75*window.spwashi.parameters.height,id:`(${Date.now()})[${Math.random()}]`}));j(...i.map(G.normalize).map(Bt)),t.nodesAdded.push(...i),t.physicsChange=!0}},cf={regex:/^@=(.+)/,handler:(t,e)=>{e.split(",").forEach(i=>{const r=B().find(o=>o.id===i||o.identity===i);r&&t.nodesImpacted.push(r)}),t.physicsChange=!0}},lf={regex:/^box=(-?\d+)/,handler:(t,e)=>{window.spwashi.parameters.forces.boundingBox=!!parseInt(e),t.physicsChange=!0}},uf={regex:/^charge=(-?\d+)/,handler:(t,e)=>{window.spwashi.parameters.forces.charge=parseInt(e),t.physicsChange=!0}},ff={regex:/^cr=(\d+)/,handler:(t,e)=>{H(n=>n.collisionRadius=parseInt(e)*n.r),t.physicsChange=!0}},df={regex:/^color=(-?\d+)/,handler:(t,e)=>{const n=parseInt(e),i=Math.sign(n)!==-1||Object.is(n,-0),r=[...B()];i&&r.reverse();const o=[Cn(yr),ht([0,r.length],a=>`hsl(230, ${a*100}%, 50%)`),ht([0,r.length],a=>`hsl(230, 100%, ${a*50}%)`),ht([0,r.length],a=>`hsl(${a*360}, 100%, 50%)`)],s=o[Math.abs(n)%o.length];r.forEach((a,l)=>{console.log(a.name),a.color=s(l)}),t.physicsChange=!0}},hf={regex:/^fontSize=(\d+)/,handler:(t,e)=>{const n=parseInt(e);B().forEach((r,o)=>{r.text.fontSize=n}),t.physicsChange=!0}},pf={regex:/^name=(.+)/,handler:(t,e)=>{const n=e,i=B(),o={identity:s=>s.identity,name:s=>s.private.name||s.name,url:s=>s.url,hash:s=>Fi(s),pos:(s,a)=>`${a}`}[n];o&&(i.forEach((s,a)=>{s.private.name=s.private.name||s.name,s.name=o(s,a)||s.name}),t.physicsChange=!0)}},wf={regex:/^nodeCount=(\d+)/,handler:(t,e)=>{window.spwashi.parameters.nodes.count=parseInt(e),t.physicsChange=!0}},gf={regex:/^r=(\d+)/,handler:(t,e)=>{H(n=>{if(n.kind!=="__boon")return n.r=parseInt(e)}),t.physicsChange=!0}},mf={regex:/^size=(\d+)/,handler:(t,e)=>{const n=parseInt(e),i=B(),r=[ht([0,i.length],s=>s*30),ht([0,i.length],s=>s*60),ht([0,i.length],s=>s*90),ht([0,i.length],s=>s*120)],o=r[n%r.length];i.forEach((s,a)=>{s.r=o(a)}),t.physicsChange=!0}},yf={regex:/^sort=(.+)/,handler:(t,e)=>{const n=e,i=B(),o={name:(s,a)=>s.name.localeCompare(a.name),"name+":(s,a)=>s.name.localeCompare(a.name),"name-":(s,a)=>a.name.localeCompare(s.name),r:(s,a)=>s.r-a.r,"r+":(s,a)=>s.r-a.r,"r-":(s,a)=>a.r-s.r,cluster:(s,a)=>s.colorindex-a.colorindex,"cluster-":(s,a)=>s.colorindex-a.colorindex,"cluster+":(s,a)=>a.colorindex-s.colorindex,z:(s,a)=>s.z-a.z,"z+":(s,a)=>s.z-a.z,"z-":(s,a)=>a.z-s.z}[n];o&&(i.sort(o),t.physicsChange=!0)}},xf={regex:/^!(.+)/,handler:(t,e)=>{window.spwashi.superpower={name:e,intent:1},t.physicsChange=!0}},vf={regex:/^https:\/\/(.+)/,handler:(t,e)=>{const n={name:e,url:`https://${e}`,collisionRadius:30,r:20,charge:-1e3,fx:window.spwashi.parameters.width/2};j(n),t.nodesAdded.push(n),t.valueStrings.push(n.url)}},kf={regex:/^velocityDecay=(-?\d*\.?\d+)/,handler:(t,e)=>{window.spwashi.parameters.forces.velocityDecay=parseFloat(e),t.physicsChange=!0}},_f={at:cf,add:af,box:lf,charge:uf,velocityDecay:kf,nodeQueue:wf,collisionRadius:ff,radius:gf,superpower:xf,url:vf,color:df,size:mf,sort:yf,name:pf,fontSize:hf};function bf(t,e){let n=!1;if(Object.entries(_f).forEach(([i,{regex:r,handler:o}])=>{const s=r.exec(t);if(s&&s[1]){n=!0;const a=s.slice(1);o(e,...a)}}),!n)return sf(t,e),!1}function Sf(){const t=window.spwashi.getItem("parameters.spw-parse-field")||"",e=document.querySelector("#spw-parse-field");if(!e){window.spwashi.callbacks.acknowledgeLonging("wondering about spw input");return}return e.value=t,e.addEventListener("paste",n=>{const i=(n.clipboardData||n.originalEvent.clipboardData).items;for(const o of i)if(o.type.indexOf("image")===0){const s=o.getAsFile();var r=new FileReader;r.onload=function(a){const l=a.target.result;Wr(l)},r.readAsDataURL(s),hn()}}),e}function Cr(t){const e={physicsChange:!1,nextDocumentMode:"",liveStrings:[],valueStrings:[],nodesAdded:[],nodesImpacted:[],nodesIgnored:[]},n={};return H(r=>{r.stroke=void 0,n[r.id]=r}),t.split(`
`).map(r=>{if(n[r]){e.nodesIgnored.push(n[r]);return}bf(r,e)}),e.nodesAdded.forEach(r=>{r.stroke="turquoise",r.strokeWidth=10,G.normalize(r),Bt(r)}),e.nodesIgnored.forEach(r=>{r.r=10}),e.nodesImpacted.forEach(r=>{r.strokeWidth=10}),e.physicsChange&&window.spwashi.reinit(),{nextDocumentMode:e.nextDocumentMode,liveStrings:e.liveStrings,valueStrings:e.valueStrings}}class ne{constructor(e,n=void 0,i=!1){this._head=e,this._operator=n,this._isPrefixed=i}operator(e){if(!e)return this._operator;this._operator=e}get parts(){const e=[this._head,this._operator];return this._isPrefixed?e.reverse():e}}class Nf extends ne{}class Mf extends ne{get parts(){return this._isPrefixed?super.parts.reverse():super.parts}}class Cf extends ne{}class Ef extends ne{}class Tf{constructor(e){this._seedNode=e,this.fillOperator=Af(e)}get seedNode(){return this._seedNode}initTail(){const e=this.seedNode;if(!e.tail)return;this._trailingOperator;const n=e.tail;return this._tail=new Ef(n),this._tail}initBody(){const e=this.seedNode,n=e==null?void 0:e.body;if(!n)return;const i=[];for(const r of n)this._trailingOperator=this.fillOperator(),i.push(new Mf(r,this._trailingOperator,!1));return this._body=new Cf(i),this._body}initHead(){const e=this.seedNode;let n=this.fillOperator();return e.head&&(this._head=new Nf(e.head,n),n=void 0),this._trailingOperator=n,this._head}*produce(){const e=this.initHead();e&&(yield e);const n=this.initBody();n&&(yield n);const i=this.initTail();i&&(yield i)}}function Af(t){let e=0;return function(){var n;const i=(n=t.operators)===null||n===void 0?void 0:n[e];return e++,i}}class Dn{constructor(e,n=void 0){var i,r;this._generation=((i=e==null?void 0:e._generation)!==null&&i!==void 0?i:-1)+1,this._context=n??e,this._root=(r=e._root)!==null&&r!==void 0?r:e}spawn(e){return new Dn(this,e)}key(e){return e}*loop(e){if(Array.isArray(e)){for(const i of e)yield e;return}if(!e)return;yield*new Tf(e).produce()}}class Er{constructor(e=void 0){this.generators=[],this.Cursor=Tr,this.source=e}getCursor(e){return new this.Cursor({input:e,generators:this.generators})}*locate(e){yield new Dn(e)}}class Jt extends Er{reduce(e,n=void 0){if(e instanceof ne)return this._reduceArray(e.parts,n);if(typeof e>"u"||e===null){this._reduceNothing();return}return Array.isArray(e)?this._reduceArray(e,n):typeof e=="string"?this._reduceString():e.key?this._reduceAtom(e,n):this._reduceNode(e,n)}_reduceNode(e,n){const i=n.spawn(e),r=[];for(const a of i.loop(e)){const l=this.reduce(a,i);l&&r.push(l)}const o=Jt.doFlatten?r.flat():r;return(Jt.doFlatten?!1:!n.generation)?{kind:e.kind,key:o}:o}_reduceNothing(){}_reduceAtom(e,n){return n.key(e)}_reduceString(){return null}_reduceArray(e,n){const i=[];for(const r of e){const o=this.reduce(r,n);o&&i.push(o)}return i.length<2?i[0]:i.flat()}}Jt.doFlatten=!0;class Fe{constructor(e){this._kind=[],this.cursor=e}set kind(e){this._kind.push(e)}get kind(){return this._kind.join(" ")}get identity(){const e=[],n=new Jt(this);for(const r of n.locate(this)){const o=n.reduce(this,r);o&&e.push(o)}this.head,this.body,this.tail,this.kind;function i(r){return r.key?r.key:Array.isArray(r)?r.map(i).join(""):r}return e.reduce((r,o)=>""+r+i(o),"")}toJSON(){return Object.fromEntries(Object.entries({identity:this.identity,kind:[...this._kind].join(Fe.kindJunctionStr),head:this.head,body:this.body,tail:this.tail}).filter(([,e])=>!!e))}}Fe.kindJunctionStr=" + ";var ue=function(t,e,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n},fe=function(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)},me,yt;class Tr{constructor(e,n){var i;me.set(this,void 0),yt.set(this,void 0),this.__log_taken=[],this.offset=(e==null?void 0:e.offset)||0,this.start=(i=n==null?void 0:n.start)!==null&&i!==void 0?i:this.offset,this.input=e==null?void 0:e.input,this.generators=e==null?void 0:e.generators,this.level=typeof(e==null?void 0:e.level)<"u"?e.level+1:0,ue(this,me,n||e||void 0,"f"),ue(this,yt,null,"f")}spawn(e){const n=this.constructor;return new n(this,e)}get parent(){return fe(this,me,"f")}setOffset(e){this.offset=e.offset}curr(){return this.input[this.offset]}*scan(e=void 0,n){const i=e??this.generators;if(!i)throw new Error("Cannot scan without generators");let r=n;for(const o of i){const s=yield*o(this,r),a=s?s.getToken():!1;a&&(this.setOffset(s),a!==(r==null?void 0:r.getToken())&&(yield s),r=s)}return r}*log(e){{const n="	".repeat(this.level);yield`${n}${this}`,yield`${n}	${e.message}`,e.miss&&(yield`${n}		reason: ${e.miss}`)}}*take(){const e=this.pos();return this.__log_taken.push(e),yield e,this.advance(),e}advance(){this.offset=this.offset+1}pos(){return{kind:"pos",offset:this.offset}}getToken(){return fe(this,yt,"f")}token(e){var n;return e===!1?(ue(this,yt,e,"f"),this):(ue(this,yt,(n=fe(this,yt,"f"))!==null&&n!==void 0?n:new Fe(this),"f"),Object.assign(fe(this,yt,"f"),e),this)}static isCursorPosition(e){return e?typeof e.offset<"u"&&e.kind==="pos":!1}}me=new WeakMap,yt=new WeakMap;class On extends Tr{static isCharacterCursor(e){return typeof(e==null?void 0:e.start)<"u"}toString(){const e=this.toJSON();return`(line: ${e.start.line}, col: ${e.start.col})`}pos(){return Object.assign(Object.assign({},super.pos()),{key:this.curr()})}toJSON(){var e,n;const i=this.offset-1,r=this.input.slice(0,this.start).split(`
`),o=r.length,s=this.text,a=s.split(`
`);return{level:this.level,start:{line:o,col:(((e=r.pop())===null||e===void 0?void 0:e.length)||1)-1,offset:this.start},end:{line:o+a.length-1,col:(((n=a.pop())===null||n===void 0?void 0:n.length)||1)-1,offset:i},text:s}}get text(){return this.input.slice(this.start,this.offset)}}var If=function(t,e,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n},de=function(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)},ye,xe,Ar,Ir,zr;class dt{constructor(e){xe.set(this,void 0),If(this,xe,e,"f")}*scan(e){let n,i,r=de(this,xe,"f").getCursor(e);for(yield*r.log({message:"beginning loop"});r.curr();){if(r=yield*r.scan(),!r){yield{error:!0,message:"did not generate a token"};break}try{i=yield*de(dt,ye,"m",zr).call(dt,r,i)}catch(o){r=!1,n=o;break}}return r?(yield*de(dt,ye,"m",Ir).call(dt,r),r.getToken()):(yield*de(dt,ye,"m",Ar).call(dt,n),!1)}getCursor(e){return new On({input:e})}}ye=dt,xe=new WeakMap,Ar=function*(e){yield{success:!1,error:!0,message:{error:e}},yield!1},Ir=function*(e){yield*e.log({success:!0,message:"ending loop"}),yield e.getToken()},zr=function*(e,n){const i=e?e.getToken():null;if(!i&&n)throw yield*e.log({error:!0,message:"token stream broke",info:{currentToken:i,prevCursor:n}}),new Error("token stream broke");if((n==null?void 0:n.offset)===e.offset)throw yield*e.log({error:!0,message:"cursor did not change positions"}),new Error("token stream broke");return e};function zf(t){const e=t.curr();return e?/\d/.test(e):!1}function Ke(t){const e=t.curr();return e?/\d/.test(e):!1}function*At(t,e){const n=t.spawn(e);if(n.token({kind:"numeric"}),e)return yield*n.log({message:"not numeric",miss:"cannot follow prev",cursors:{start:t,prev:e}}),e;const{integral:i,fractional:r}=yield*Df(n);if(!(i.length||r.length))return yield*n.log({message:"not numeric",miss:"no integral or fractional components"}),!1;yield*n.log({message:"resolving numeric"});const o=i.length?parseInt(i.join("")):0,s=r.length?parseFloat(`.${r.join()}`):void 0,a={key:o+(s??0)};return n.token({head:a,integral:o,fractional:s}),n}function*Df(t){const e=[];{let i=zf,r;for(;i(t);)!r&&(r=!0)&&(i=Ke,yield*t.log({message:"beginning numeric",info:{component:"integral"}})),e.push(t.curr()),yield*t.take()}const n=[];if(t.curr()==="."){yield*t.take();let i=!1,r=Ke;for(;r(t);)!i&&(i=!0)&&(r=Ke,yield*t.log({message:"continuing numeric",info:{component:"fractional"}})),n.push(t.curr()),yield*t.take()}return{integral:e,fractional:n}}function Dr(t){return t?/[a-zA-Z]/.test(t):!1}function Of(t){return t?Dr(t)||t==="_":!1}const mi={name:"conceptual.open",key:"<",opposite:">",kind:"delimiter",open:!0},yi={name:"locational.open",key:"(",opposite:")",kind:"delimiter",open:!0},xi={name:"structural.open",key:"{",opposite:"}",kind:"delimiter",open:!0},vi={name:"essential.open",key:"[",opposite:"]",kind:"delimiter",open:!0},ki={name:"conceptual.close",key:">",opposite:"<",kind:"delimiter",close:!0},_i={name:"locational.close",key:")",opposite:"(",kind:"delimiter",close:!0},bi={name:"structural.close",key:"}",opposite:"{",kind:"delimiter",close:!0},Si={name:"essential.close ",key:"]",opposite:"[",kind:"delimiter",close:!0},$f={"<":mi,"(":yi,"{":xi,"[":vi,_inverse:{">":mi,")":yi,"}":xi,"]":vi}},Rf={">":ki,")":_i,"}":bi,"]":Si,_inverse:{"<":ki,"(":_i,"{":bi,"[":Si}},fn={open:$f,close:Rf};function Lf(t){const e=t.curr();return e?!!fn.open[e]:!1}function Or(t){return t.curr()===" "}function*P(t){const e=[];for(;Or(t);)e.push({key:t.curr()}),yield*t.take();return e}const $r={"*":{name:"salience",key:"*",kind:"pragmatic",kinds:new Set(["pragmatic","nominal"])},"@":{name:"perspective",key:"@",kind:"pragmatic",kinds:new Set(["pragmatic","nominal"])},":":{name:"binding",key:"@",kind:"pragmatic",kinds:new Set(["pragmatic","nominal"])},"+":{name:"aggregation",key:"+",kind:"pragmatic",kinds:new Set(["pragmatic","nominal"])},"-":{name:"reduction",key:"-",kind:"pragmatic",kinds:new Set(["pragmatic","nominal"])},"=":{nodes:{">":{name:"transformation",key:"=>",kind:"pragmatic",kinds:new Set(["pragmatic","nominal"])}}}};function*Pf(t,e=$r){let n=t.curr(),i=e[n];const r=[];for(;e[n];){if(r.push(n),i=e[n],!i.nodes){t.advance();break}e=i.nodes,yield*t.take(),n=t.curr()}return[i,r.join("")]}function*Ff(t){let e=!1,n;return t.curr()==="_"&&(n=yield*t.take(),e=yield*t.scan([It,At,_t])),[n,e]}function Tt(t){return function*(e){const n=e.spawn();n.token({kind:"operator"}),yield*n.log({message:"checking operator"});const[i,r]=yield*Pf(n,t);if(i&&(n.token({proto:i}),n.token({kind:i.kind}),n.token({kind:i.name})),!i)return yield*n.log({message:"not an operator",miss:"no prototype",cursors:{start:e},info:{operators:t,curr:e.curr()}}),!1;const[o,s]=yield*Ff(n);return n.token({body:[{key:r}],operators:o?[o]:void 0,tail:s?s.getToken():void 0}),n}}const Bf=[It,At,_t];function*ie(t,e){const n=t.spawn(e);if(n.token({kind:"phrasal"}),yield*n.log({message:"checking phrasal"}),!e)return yield*n.log({message:"not phrasal",miss:"no head",cursors:{start:t,prev:e}}),!1;const{head:i,body:r,tail:o,operators:s}=yield*qf(n,e);return o?(yield*n.log({message:"resolving phrasal"}),n.token({head:i,body:r,tail:o,operators:s}),n):(yield*n.log({message:"not phrasal",miss:"no tail",cursors:{start:t,prev:e,cursor:n},info:{head:i,body:r,tail:o,operators:s}}),e??!1)}function*qf(t,e){const n=e&&e.getToken(),i=[],r=[];{let s=!1;for(;Or(t);){!s&&(s=!0)&&(yield*t.log({message:"beginning ordinal"}));const a=yield*P(t);r.push(a),yield*P(t);const l=yield*t.scan(Bf),c=l?l.getToken():null;if(!c)break;i.push(c)}}const o=i.pop();return{head:n,body:i,tail:o,operators:r}}function Hf(t){return t.curr()===","}const Xf=[It,At,_t,ie],Yf={",":{name:"common",key:",",kind:"delimiter"}},Uf={";":{name:"ordinal",key:";",kind:"delimiter"},"\n":{name:"ordinal",key:";",kind:"delimiter"}};function*$n(t,e){const n=t.spawn(e);n.token({kind:"common"}),yield*n.log({message:"checking common"});const{head:i,body:r,tail:o,operators:s}=yield*Kf(n,e);return s.length?(yield*n.log({message:"resolving common"}),n.token({head:i,body:r,tail:o,operators:s}),n):(yield*n.log({message:"not common",miss:"no operators"}),e??!1)}function*Kf(t,e){yield*P(t);const n=e&&e.getToken(),i=[],r=[];let o=!1;for(;Hf(t);){!o&&(o=!0)&&(yield*t.log({message:"beginning common"})),yield*P(t);const a=yield*t.scan([Tt(Yf)]),l=a==null?void 0:a.getToken();if(!l)break;r.push(l),yield*P(t);const c=yield*t.scan(Xf);let u=c?c.getToken():null;u||(u=null),i.push(u),yield*P(t)}const s=i.pop();return{head:n,body:i,tail:s,operators:r}}function jf(t){return t.curr()===";"||t.curr()===`
`}const Vf=[It,At,_t,ie,Be];function*Be(t,e,n=$r){var i;const r=t.spawn(e);r.token({kind:"operational"}),yield*r.log({message:"checking operational"});let{head:o,body:s,tail:a,operators:l,initialProto:c}=yield*Wf(r,e,n);return l.length?(((i=c==null?void 0:c.kinds)===null||i===void 0?void 0:i.has("nominal"))&&!a&&(a=null),r.token({operators:l}),(c==null?void 0:c.kind)==="delimiter"?r:(l.length===1&&(r.token({kind:c.kind}),r.token({kind:c.name})),typeof a>"u"?(yield*r.log({message:"not operational",miss:"missing a tail component",cursor:r,info:{head:o,body:s,tail:a,tok:r.getToken()}}),r.token(!1),!1):(yield*r.log({message:"resolving operational",cursor:r}),!o&&!a&&r.token({kind:"conceptual"}),r.token({head:o,body:s,tail:a}),r))):(yield*r.log({message:"not operational",miss:"no operators"}),!1)}function*Wf(t,e,n){const i=e&&e.getToken(),r=[],o=[];n[" "]||(yield*P(t));let s,a;for(;s=yield*t.scan([Tt(n)]);){if(!s)continue;if(!(s!=null&&s.getToken()))break;yield*t.log({message:"beginning operational"}),o.push(s.getToken());const c=s.getToken().proto;if(a=a||c,c.open){const d=yield*P(s);d.length&&r.push(d[0])}c.close||(yield*P(t));const u=yield*t.scan(Vf,c.close?s:void 0),f=u?u.getToken():null;if(!f)break;r.push(f),yield*P(t)}const l=r.pop();return{head:i,body:r,tail:l,operators:o,initialProto:a}}const Gf=[It,At,_t,ie,$n,Be];function*Rr(t,e){const n=t.spawn(e);n.token({kind:"ordinal"}),yield*n.log({message:"checking ordinal"});const{head:i,body:r,tail:o,operators:s}=yield*Qf(n,e);return s.length?(yield*n.log({message:"resolving ordinal"}),n.token({head:i,body:r,tail:o,operators:s}),n):(yield*n.log({message:"not ordinal",miss:"no operators"}),e??!1)}const Jf=Tt(Uf);function*Qf(t,e){yield*P(t);const n=e&&e.getToken(),i=[],r=[];let o;{let a=!1;for(;jf(t);){!a&&(a=!0)&&(yield*t.log({message:"beginning ordinal"})),yield*P(t);const l=yield*t.scan([Jf]),c=l==null?void 0:l.getToken();if(!c)break;!o&&r.push(o=[]),o.push(c),yield*P(t);const u=yield*t.scan(Gf);let f=u?u.getToken():null;f?o=null:f=null,i.push(f),yield*P(t)}}const s=i.pop();return{head:n,body:i,tail:s,operators:r}}const Ni={name:"open-conceptual",key:'"',opposite:'"',kind:"delimiter",open:!0},Mi={name:"open-locational",key:"`",opposite:"`",kind:"delimiter",open:!0},Ci={name:"close-conceptual",key:'"',opposite:'"',kind:"delimiter",close:!0},Ei={name:"close-locational",key:"`",opposite:"`",kind:"delimiter",close:!0},Zf={'"':Ni,"`":Mi,_inverse:{'"':Ni,"'":Mi}},td={'"':Ci,"`":Ei,_inverse:{'"':Ci,"`":Ei}},dn={open:Zf,close:td};function ed(t){const e=t.curr();return e?!!dn.open[e]:!1}function Lr(t){return t?t!=='"'&&t!=="`":!1}function nd(t){return t?Lr(t)||t==="_":!1}function*id(t,e){const n=t.spawn(e);if(n.token({kind:"anything"}),yield*n.log({message:"checking anything"}),e)return yield*n.log({message:"not anything",miss:"cannot follow prev"}),e;const i=yield*rd(n);if(!i.length)return yield*n.log({message:"not anything",miss:"no key"}),!1;yield*n.log({message:"resolving anything"});const r={key:i};return n.token({head:r}),n}function*rd(t){const e=[];{let n,i=Lr;for(;t.curr()&&i(t.curr());)!n&&(n=!0)&&(yield*t.log({message:"beginning anything"})),e.push(t.curr()),yield*t.take(),i=nd}return e}const od=[id];function*Pr(t,e){const n=t.spawn(e);if(n.token({kind:"literal"}),yield*n.log({message:"checking literal"}),e)return yield*n.log({message:"not literal",miss:"prev"}),e;if(!ed(t))return yield*n.log({message:"not literal",miss:"cursor cannot start literal"}),!1;const{head:i,body:r,tail:o}=yield*sd(n);return yield*n.log({message:"resolving literal"}),n.token({head:i,body:r,tail:o}),n}function*sd(t){var e,n;const i=dn.open,r=yield*t.scan([Tt(i)]),o=r==null?void 0:r.getToken(),s=(e=o==null?void 0:o.label)===null||e===void 0?void 0:e.key,a=dn.close._inverse[o.proto.key];if(!a)throw new Error("could not resolve type");yield*P(t);let l,c;const u=[];for(;t.curr();){!l&&(l=!0)&&(yield*t.log({message:"beginning literal"})),yield*P(t);const f=yield*t.scan([Tt({[a.key]:a})]),d=f==null?void 0:f.getToken(),h=(n=d==null?void 0:d.label)===null||n===void 0?void 0:n.key;if(d){if(h===s||!(h&&s)){c=d;break}u.push(d),yield*P(t)}const x=yield*t.scan(od);if(!x)break;u.push(x==null?void 0:x.getToken()),yield*P(t)}return{head:o,body:u,tail:c}}const ad=[It,At,_t,Pr,ie,$n,Rr,Be];function*_t(t,e){const n=t.spawn(e);if(n.token({kind:"container"}),yield*n.log({message:"checking container"}),e)return yield*n.log({message:"not container",miss:"prev"}),e;if(!Lf(t))return yield*n.log({message:"not container",miss:"cursor cannot start container"}),!1;const{head:i,body:r,tail:o}=yield*cd(n);return n.token({kind:i.proto.name.split(".")[0]}),yield*n.log({message:"resolving container"}),n.token({head:i,body:r,tail:o}),n}function*cd(t){var e,n;const i=fn.open,r=yield*t.scan([Tt(i)]),o=r==null?void 0:r.getToken(),s=(e=o==null?void 0:o.label)===null||e===void 0?void 0:e.key,a=fn.close._inverse[o.proto.key];if(!a)throw new Error("could not resolve type");yield*P(t);let l,c;const u=[];for(;t.curr();){!l&&(l=!0)&&(yield*t.log({message:"beginning container"})),yield*P(t);const f=yield*t.scan([Tt({[a.key]:a})]),d=f==null?void 0:f.getToken(),h=(n=d==null?void 0:d.label)===null||n===void 0?void 0:n.key;if(d){if(h===s||!(h&&s)){c=d;break}u.push(d),yield*P(t)}const x=yield*t.scan(ad);if(!x)break;u.push(x==null?void 0:x.getToken()),yield*P(t)}return{head:o,body:u,tail:c}}function*ld(t){var e;const n=new Map;let i;for(;(i=yield*t.scan([_t]))&&(i=i.getToken());){const r=(e=n.get(i.head.proto))!==null&&e!==void 0?e:[];r.push(i),n.set(i.head.proto.name,r)}return n}function*ud(t){const e=yield*ld(t);t.token({definition:e}),e.size&&t.token({body:[...e.values()]})}function*It(t,e){const n=t.spawn(e);if(n.token({kind:"nominal"}),yield*n.log({message:"checking nominal"}),e)return yield*n.log({message:"not nominal",miss:"cannot follow prev"}),e;const i=yield*fd(n);if(!i.length)return yield*n.log({message:"not nominal",miss:"no key"}),!1;yield*n.log({message:"resolving nominal"});const r={key:i};return n.token({head:r}),yield*ud(n),n}function*fd(t){const e=[];{let n,i=Dr;for(;t.curr()&&i(t.curr());)!n&&(n=!0)&&(yield*t.log({message:"beginning nominal"})),e.push(t.curr()),yield*t.take(),i=Of}return e.join("")}const dd={literal:Pr,container:_t,nominal:It,numeric:At},hd={operational:Be},pd={phrasal:ie,common:$n,ordinal:Rr},wd=Object.assign(Object.assign(Object.assign({},dd),hd),pd);class gd extends Er{constructor(){super(...arguments),this.generators=Object.values(wd),this.Cursor=On}}function Fr(t,{asGenerator:e=!1}={}){if(e)return i();let n;for(const r of i())n=r;return n;function*i(){const r=new gd;yield*new dt(r).scan(t)}}function md(t,e={}){const n=t.value,{liveStrings:i,nextDocumentMode:r,valueStrings:o}=Cr(n);if(r==="spw"){e.doFocusH1After=!1,e.href=null,window.spwashi.spwEditor.value=o.join(`
`),K("spw",!1,!0);return}const s=o.join(`
`);if(!s)return;const a=JSON.parse(JSON.stringify(Fr(s))),l=Qe(),c=a.identity||n.trim();return e.href=ve(pn(c),c,l),e}function yd(t){let e=document.querySelector("#main-wonder-button");if(!e){const n={click:()=>{t()}},i={get:(r,o)=>o==="onclick"?r.click:r[o]};e=new Proxy(n,i)}return e.onclick=n=>{n.stopPropagation(),t()},e}function xd(){const t=document.querySelector("h1"),e=t.innerText,n=document.querySelector("#title-md5"),i=pn(e);if(!n){window.spwashi.callbacks.acknowledgeLonging("wondering about md5 element");return}n.innerText=`${i}`.slice(0,8),n.href=ve(i,e);const r=yd(a);t.tabIndex=0,t.onclick=l=>{l.target===t&&(l.stopPropagation(),a())},t.onkeydown=l=>{if(l.ctrlKey||l.metaKey){l.key==="c"&&navigator.clipboard.writeText(e);return}l.key!=="Shift"&&l.target===t&&l.key!=="Tab"&&(l.key===" "&&l.preventDefault(),!l.key.match(/\d/)&&r.click())};let o;function s(l=!0){document.removeEventListener("click",o),t.innerText=e,l&&t.focus()}function a(){const l=document.createElement("form"),c=document.createElement("input");c.onpaste=d=>{d.preventDefault();const h=d.clipboardData.getData("text/plain");Sr(h)},c.value=e,c.id="h1-input",c.autocomplete="off",l.appendChild(c);const u=document.createElement("button");u.type="submit",u.innerText="submit";const f={doFocusH1After:!0,href:null};l.appendChild(u),t.innerHTML="",t.appendChild(l),c.focus(),c.setSelectionRange(0,c.value.length),u.onclick=d=>{d.preventDefault(),md(c,f),f.href&&(window.location.href=f.href),s(f.doFocusH1After)},o=d=>{const h=d.target;t.contains(h)||s(f.doFocusH1After)},u.onblur=()=>{s(f.doFocusH1After)},document.addEventListener("click",o)}}function vd(){const t=document.querySelector("#query-parameters .value");if(!t){window.spwashi.callbacks.acknowledgeLonging("wondering about querystring element");return}const e=[...new URLSearchParams(window.location.search)].map(i=>i.join("=")).join(`
`);t.innerHTML=e,t.rows=e.split(`
`).length+1;const n=document.querySelector("#query-parameters button.go");n.onclick=i=>{const r=new URLSearchParams(t.value.split(`
`).map(o=>o.split("=")));Qt(r),i.shiftKey&&(window.location="?"+r)}}const Ti="center";let je=null;function kd(){return je=je||{identity:Ti,r:0,collisionRadius:100,x:window.spwashi.parameters.width/2,y:window.spwashi.parameters.height/2},j(je),Ti}function _d(t){const e=kd();window.spwashi.reinit();const n=[];for(let i of t){const r={source:i.id,target:window.spwashi.getNode(e).id,strength:.1};vt(n,r)}return n}const bd="spwashi-action-";function Sd(t){return bd+t}function Nd(){window.spwashi.boon=(l,c=window.spwashi.parameters.nodes.count)=>{async function*u(d=100,h=window.spwashi.parameters.nodes.count){for(let x=0;x<h;x++)yield x,await new Promise(w=>setTimeout(w,d))}async function f(){let d=[];for await(const h of u(l,c)){const x=Mu["@node"](h,c);j(x),window.spwashi.reinit(),d.push(x)}return d}return f()},window.spwashi.bane=l=>{async function*c(f,d){let h=l||B();for(let x=100;x--;x>0)for(let w of h)yield w,await new Promise(m=>setTimeout(m,f))}async function u(){let f=[];for await(const d of c(10))d.r=Math.min(d.r*Math.random(),100),d.r=Math.max(d.r*Math.random(),10);return f}return u()},window.spwashi.bone=()=>{const l=new Map;for(let c of window.spwashi.nodes){const u=l.get(c.colorindex)||[];u.push(c),l.set(c.colorindex,u)}[...l.values()].forEach(c=>{let u,f;for(let d of c){f=f||d;let h=window.spwashi.getNode(u==null?void 0:u.id),x=window.spwashi.getNode(d.id);const w={source:x,target:h,colorindex:x.colorindex,strength:window.spwashi.parameters.links.strength*.3};x&&vt(window.spwashi.links,w),u=d}vt(window.spwashi.links,{source:u==null?void 0:u.id,target:f==null?void 0:f.id,strength:window.spwashi.parameters.links.strength*.3})}),window.spwashi.reinit()},window.spwashi.bonk=l=>{(l||window.spwashi.nodes).forEach(c=>(c.color=void 0,c.colorindex+=1)),window.spwashi.reinit()},window.spwashi.honk=()=>{window.spwashi.links.forEach(l=>(l.colorindex=l.colorindex?l.colorindex+1:kt(),l.strength*=1.5)),window.spwashi.reinit()};const o=[{title:"Lore",reflexes:[["boon",()=>{window.spwashi.boon()}],["bone",()=>{window.spwashi.bone()}],["honk",()=>{window.spwashi.honk()}],["bane",()=>{window.spwashi.bane(),window.spwashi.reinit()}],["bonk",()=>{window.spwashi.bonk()}]]},{title:"Set Charge",reflexes:[["-100",()=>{window.spwashi.parameters.forces.charge=-100,window.spwashi.reinit()}],["0",()=>{window.spwashi.parameters.forces.charge=0,window.spwashi.reinit()}],["100",()=>{window.spwashi.parameters.forces.charge=100,window.spwashi.reinit()}],["-1k",()=>{window.spwashi.parameters.forces.charge=-1e3,window.spwashi.reinit()}],["-10k",()=>{window.spwashi.parameters.forces.charge=-1e4,window.spwashi.reinit()}]]},{title:"Adjust Radius",reflexes:[["*=3.2",()=>{H(l=>l.r*=3.2),window.spwashi.reinit()}],["/=2.3",()=>{H(l=>l.r/=2.3),window.spwashi.reinit()}],["=10",()=>{H(l=>l.r=10),window.spwashi.reinit()}]]},{title:"Adjust Charge",reflexes:[["-100",()=>{window.spwashi.parameters.forces.charge-=100,window.spwashi.reinit()}],["-10",()=>{window.spwashi.parameters.forces.charge-=10,window.spwashi.reinit()}],["*-1",()=>{window.spwashi.parameters.forces.charge*=-1,window.spwashi.reinit()}],["+10",()=>{window.spwashi.parameters.forces.charge+=10,window.spwashi.reinit()}],["*13",()=>{window.spwashi.parameters.forces.charge*=10,window.spwashi.reinit()}]]},{title:"Forces",reflexes:[["link",()=>{const l=[_d,br],c=window.spwashi.__session.i++,u=l[c%l.length];window.spwashi.links=u(window.spwashi.nodes),window.spwashi.reinit()}],["speed decay",()=>{const l=["0.1","0.2","0.3","0.4","0.5"],c=window.spwashi.__session.i++;window.spwashi.parameters.forces.velocityDecay=l[c%l.length],window.spwashi.reinit()}],["box",()=>{window.spwashi.parameters.forces.boundingBox=!window.spwashi.parameters.forces.boundingBox,window.spwashi.reinit()}]]}],s=document.querySelector("#reflexes");if(!s){window.spwashi.callbacks.acknowledgeLonging("wondering about reflex container");return}let a=0;o.forEach(({title:l,reflexes:c})=>{const u=s.appendChild(document.createElement("section"));u.classList.add("card");const f=u.appendChild(document.createElement("header"));f.classList.add("card-header");const d=u.appendChild(document.createElement("div"));d.classList.add("card-body");const h=d.appendChild(document.createElement("div"));h.classList.add("button-container"),f.innerText=l,c.forEach(x=>{const w=h.appendChild(document.createElement("button"));w.innerText=x[0],w.onclick=()=>{x[1](),K(null),document.querySelector("#mode-selector--reflex").focus()},w.dataset.actionindex=Sd(a++)})})}function Md(){document.querySelector("#reflexes button").focus();const t=document.querySelectorAll("#reflexes button"),e={},n={};t.forEach(i=>{const r=i.getBoundingClientRect(),o=Math.round(r.x),s=Math.round(r.y);e[o]||(e[o]=[]),n[s]||(n[s]=[]),e[o].push(i),n[s].push(i)}),window.spwashi.callbacks.arrowLeft=()=>{const i=document.activeElement,r=Math.round(i.getBoundingClientRect().y),o=n[r],s=o.indexOf(i),a=o[s-1]||o[o.length-1];a&&a.focus()},window.spwashi.callbacks.arrowRight=()=>{const i=document.activeElement,r=Math.round(i.getBoundingClientRect().y),o=n[r],s=o.indexOf(i),a=o[s+1]||o[0];a&&a.focus()},window.spwashi.callbacks.arrowUp=()=>{const i=document.activeElement,r=Math.round(i.getBoundingClientRect().x),o=e[r],s=o.indexOf(i),a=o[s+1]||o[0];a&&a.focus()},window.spwashi.callbacks.arrowDown=()=>{const i=document.activeElement,r=Math.round(i.getBoundingClientRect().x),o=e[r],s=o.indexOf(i),a=o[s-1]||o[o.length-1];a&&a.focus()}}function Cd(){En(),vr(),window.spwashi.perspectiveMap.delete(kt()),window.spwashi.reinit()}const Ed=(t,e)=>t.fy=75*(e+1),Td=(t,e)=>t.fx=75;async function*Ad(t){for(let{delay:e,payload:n}of t)await new Promise(i=>setTimeout(i,e)),yield n}async function Br(t){for await(const e of Ad(t)){if(e.effect&&e.effect(),e.params&&Qt(new URLSearchParams(e.params)),e.nodes){const n=e.nodes.map(Bt).map(G.normalize);j(...n)}window.window.spwashi.reinit()}}function Rn(t){const e=document.querySelector("#spw-parse-field");e.value=t,e.focus();const n=e.value.indexOf("&");e.setSelectionRange(n,n+1)}function Id(){for(let t in Mt)Mt.hasOwnProperty(t)&&delete Mt[t]}function qr(){return["< & >","( & )","{ & }","[ & ]"]}function Hr(){return["context","topic","structure","status"]}const Ve=qr(),We=Hr();function ze(t=!1){Id();const e=We.shift();if(!e||t){Ve.length=0,We.length=0,Ve.push(...qr()),We.push(...Hr()),ze();return}Mt[e]={params:{superpower:"hyperlink"},events:[{delay:300,payload:{params:{mode:"spw"}}},{delay:300,payload:{effect:()=>Rn(Ve.shift())}},{delay:300,payload:{effect:ze}}]},Xr()}const Mt={};ze();Mt.demo={params:{width:300,height:500,superpower:"hyperlink",velocityDecay:.9,center:"150,250"},runStory:()=>{Br([{delay:50,payload:{nodes:[{r:10,x:30,y:50,text:{fx:75,fontSize:30},name:"hello"}]}},{delay:50,payload:{nodes:[{r:10,x:30,y:100,text:{fx:75,fontSize:30},name:"how"}]}},{delay:50,payload:{nodes:[{r:10,x:30,y:150,text:{fx:75,fontSize:30},name:"are"}]}},{delay:50,payload:{nodes:[{r:10,x:30,y:200,text:{fx:75,fontSize:30},name:"you"}]}},{delay:50,payload:{nodes:[{r:10,x:30,y:250,text:{fx:75,fontSize:30},name:"doing"}]}},{delay:50,payload:{nodes:[{r:10,x:30,y:300,text:{fx:75,fontSize:30},name:"today"}]}},{delay:300,payload:{params:{charge:500}}},{delay:50,payload:{params:{charge:0}}},{delay:50,payload:{effect:()=>H((i,r)=>(Td(i),Ed(i,r)))}},{delay:300,payload:{effect:()=>Cd()}},{delay:100,payload:{params:{mode:"spw"}}},{delay:300,payload:{effect:()=>Rn("i am doing & today")}}]).then(console.log)}};Mt.options={events:[{delay:300,payload:{params:{mode:"spw"}}},{delay:100,payload:{effect:()=>Rn(Mr)}},{delay:1e3,payload:{effect:()=>{window.spwashi.keystrokeRevealOrder=1}}}]};function Xr(){const t=document.querySelector("#story-mode-container");if(!t)return;t.innerHTML="";const e=document.createElement("div");e.classList.add("button-container"),t.appendChild(e),Object.entries(Mt).forEach(([n,i])=>{const r=document.createElement("button");r.innerText=n,r.onclick=()=>{Qt(new URLSearchParams(i.params)),i.runStory&&i.runStory(),i.events&&Br(i.events)},e.appendChild(r)})}function zd(){const t=document.querySelector("#colors");if(!t){window.spwashi.callbacks.acknowledgeLonging("wondering about color container");return}t.onclick=function(e){const i=e.target.dataset.dataindex;zi(i),K(null)}}function Dd(){ze(!0),document.querySelector(`#colors button[data-dataindex=${Ii(kt())}]`).focus();const t=document.querySelectorAll("#colors button"),e={},n={};t.forEach(o=>{const s=o.getBoundingClientRect(),a=Math.round(s.x),l=Math.round(s.y);e[a]||(e[a]=[]),n[l]||(n[l]=[]),e[a].push(o),n[l].push(o)});const i=Object.keys(e).sort((o,s)=>o-s).map((o,s)=>{const a=e[o];return a.forEach(l=>l.dataset.x=s),a}),r=Object.keys(n).sort((o,s)=>o-s).map((o,s)=>{const a=n[o];return a.forEach(l=>l.dataset.y=s),a});window.spwashi.callbacks.arrowUp=()=>{const o=parseInt(document.activeElement.dataset.x),s=i[o],a=s.indexOf(document.activeElement),l=a?a-1:s.length-1;s[l].focus()},window.spwashi.callbacks.arrowDown=()=>{const o=parseInt(document.activeElement.dataset.x),s=i[o],a=s.indexOf(document.activeElement),l=a===s.length-1?0:a+1;s[l].focus()},window.spwashi.callbacks.arrowRight=()=>{const o=parseInt(document.activeElement.dataset.y),s=r[o],a=s.indexOf(document.activeElement),l=a===s.length-1?0:a+1;s[l].focus()},window.spwashi.callbacks.arrowLeft=()=>{const o=parseInt(document.activeElement.dataset.y),s=r[o],a=s.indexOf(document.activeElement),l=a?a-1:s.length-1;s[l].focus()}}const Od=t=>{const e=t||window.spwashi.parameters.nodes.count,n=[...Array(e)].map(i=>({name:"boon",identity:Date.now()+Math.random()}));return j(...n.map(Bt)),window.spwashi.reinit(),n};function $d(){const t=window.spwashi.simulation;if(!t){const l="no force simulation initialized";throw alert(l),new Error(l)}const e=document.querySelector("#controls");if(!e){window.spwashi.callbacks.acknowledgeLonging("wondering about controls");return}const n=e.querySelector(".tick");n.onclick=()=>{window.spwashi.tick()};const i=e.querySelector(".start");i.onclick=()=>{t.restart()};const r=e.querySelector(".stop");r.onclick=()=>{t.stop()};const o=e.querySelector(".reinit");o.onclick=()=>{window.spwashi.reinit()};const s=e.querySelector(".clear-fixed-positions");s.onclick=()=>{H(l=>{l.fx=void 0,l.fy=void 0})};const a=e.querySelector(".generate-nodes");a.onclick=Od}const Rd=t=>{const e=[],n=Fr(t,{asGenerator:!0});for(let s of n)On.isCharacterCursor(s)&&e.push(s.getToken());const i=kt(),r={};return e.forEach(s=>r[s.identity]=r[s.identity]||s),Yr(i,Object.keys(r),r).map(s=>r[s])};function Yr(t,e,n){window.spwashi.perspectiveMap.has(t)||window.spwashi.perspectiveMap.set(t,{identities:new Set,tokenObj:{}});const i=window.spwashi.perspectiveMap.get(t),r=e.filter(o=>!i.identities.has(o));return r.forEach(o=>{i.identities.add(o)}),Object.assign(i.tokenObj,n),r}function Ld(t){return Object.fromEntries(t.map(e=>[e,{identity:e}]))}function Pd(){hn(),window.spwashi.perspectiveMap=new Map;const t=kt(),e=Oi(r=>r.identity);Yr(t,e,Ld(e));const n=Sf();if(window.spwashi.spwEditor=n,!n){window.spwashi.callbacks.acknowledgeLonging("wondering about spw input");return}const i=document.querySelector("#parse-spw");i||window.spwashi.callbacks.acknowledgeLonging("wondering about button"),i.onclick=()=>{const{nextDocumentMode:r,liveStrings:o,valueStrings:s}=Cr(n.value);K(r,!1),n.value=s.join(`
`);const a=o.filter(u=>typeof u=="string").join(`
`);window.spwashi.setItem("parameters.spw-parse-field",a);const l=Rd(a),c=JSON.parse(JSON.stringify(l));c.forEach(G.processNode),j(...c),window.spwashi.reinit(),Oe().focus()}}function Fd(t){Nr(),Kr(t),Pd(),Nd(),Bu(),vd(),zd(),$d(),Xr(),zn(()=>import("./mode-mapfilter-ZfWZUaCL.js"),__vite__mapDeps([])).then(({initializeMapFilterMode:e})=>{e()})}function Bd(t){return null}function qd(){return[{title:"Counter",x:0,width:0,calc:t=>t.width=window.spwashi.counter*1},{title:"Alpha",x:0,width:0,calc:t=>t.width=window.spwashi.simulation.alpha()*(window.spwashi.parameters.width||0)},{title:"Alpha Decay",x:0,width:0,calc:t=>t.width=window.spwashi.simulation.alphaDecay()*(window.spwashi.parameters.width||0)},{title:"Charge",x:0,width:0,calc:t=>{t.title="Charge: "+window.spwashi.parameters.forces.charge,t.width=window.spwashi.parameters.forces.charge}},{title:"Velocity Decay",x:0,width:0,calc:t=>t.width=window.spwashi.simulation.velocityDecay()*(window.spwashi.parameters.width||0)},{title:"Zoom",x:0,width:1,calc:t=>{var e;return t.title=`Zoom: ${((e=window.spwashi.zoomTransform)==null?void 0:e.k)||1}`}},{title:"Node Quantity",x:0,width:0,calc:t=>{let e=window.spwashi.nodes.length;return t.title="Node Count: "+e,t.width=e}},{title:"Node Queue Count",x:0,width:0,calc:t=>{const e=window.spwashi.parameters.nodes.count;t.title="Node Queue Count: "+e,t.width=e}}].map((t,e)=>(t.height=20,t.y=e*20,t))}function Hd(){const t=ot("svg#simulation"),e=t.select("g.simulation-content");e.select("g.rects");const n=e.select("g.edges"),i=e.select("g.nodes");return{svg:t,wrapper:e,edgesWrapper:n,nodesWrapper:i}}function Xd(t){t.attr("width",window.spwashi.parameters.width).attr("height",window.spwashi.parameters.height).attr("preserveAspectRatio","xMinYMin meet")}const De=Hd(),zt={x:0,y:0},Dt={x:0,y:0};function Yd(t){if(window.spwashi.parameters.canzoom)t.call(Gl().on("zoom",(e,n)=>{const i=(e.transform.k-1)*10;window.spwashi.zoomTransform={k:i},e.sourceEvent.shiftKey?(window.spwashi.parameters.forces._charge=window.spwashi.parameters.forces._charge||window.spwashi.parameters.forces.charge,window.spwashi.parameters.forces.charge=window.spwashi.parameters.forces._charge*i,window.spwashi.reinit()):H(r=>{r.private._r=r.private._r||r.r,r.r=r.private._r*e.transform.k})})).on("dblclick.zoom",null);else if(window.spwashi.parameters.canpan)t.call(Re().on("start",e=>{t.attr("cursor","grabbing"),zt.x=e.x,zt.y=e.y}).on("drag",e=>{const n=zt.x-e.x,i=zt.y-e.y;Dt.x+=n/10,Dt.y+=i/10,De.nodesWrapper.attr("transform",`translate(${Dt.x}, ${Dt.y})`),De.edgesWrapper.attr("transform",`translate(${Dt.x}, ${Dt.y})`)}).on("end",e=>{t.attr("cursor","grab"),zt.x=e.x,zt.y=e.y}));else{let e=null;t.on("mousedown",n=>{e={x:n.offsetX,y:n.offsetY,calc:i=>i,width:1,height:1},window.spwashi.rects.push(e),Rt("mousedown:"+n.y+" "+n.x)}).on("mousemove",n=>{if(!e)return 0;e.width=n.offsetX-e.x,e.height=n.offsetY-e.y}).on("mouseup",n=>{const i=no(e),r=Fn(i,l=>l.x),o=(r[1]-r[0])/i.length,s=Fn(i,l=>l.y),a=(s[1]-s[0])/i.length;Rt(r+" "+s),i.forEach((l,c)=>{l.fx=r[0]+o*c,l.fy=s[0]+a*c,l.charge=-1e3}),window.spwashi.rects.splice(window.spwashi.rects.indexOf(e),1),window.spwashi.reinit(),e=null,Rt("mouseup:"+n.y+" "+n.x)})}}function Ud(){window.spwashi.clearCachedNodes=()=>{window.spwashi.setItem("nodes",[])},window.spwashi.getNodeImageHref=Bd,window.spwashi.getNode=G.getNode,window.spwashi.nodes=[]}function Kd(){window.spwashi.links=[]}function jd(){window.spwashi.rects=qd()}function Vd(){window.spwashi.reinit=()=>console.log("reinit not yet defined"),Xd(De.svg),Ud(),Kd(),jd(),window.spwashi.simulation=Sl(),zn(()=>import("./reinit-atZszHju.js"),__vite__mapDeps([])).then(({reinit:t})=>{window.spwashi.reinit=t,t()})}function Wd(){window.spwashi.callbacks=window.spwashi.callbacks||{},window.spwashi.callbacks.acknowledgeLonging=t=>{console.log("acknowledge longing",t)},window.spwashi.callbacks.arrowRight=()=>{},window.spwashi.callbacks.arrowLeft=()=>{},window.spwashi.callbacks.arrowUp=()=>{},window.spwashi.callbacks.arrowDown=()=>{}}function Gd(){document.body.addEventListener("mousedown",t=>{t.target.tagName!=="BUTTON"&&t.target.tagName!=="CIRCLE"&&document.body.dataset.interfaceDepth==="standard"&&Oe()},!0)}function Jd(){const t=()=>{};window.spwashi.callbacks.arrowUp=t,window.spwashi.callbacks.arrowDown=t,window.spwashi.callbacks.arrowLeft=t,window.spwashi.callbacks.arrowRight=t}function Qd(){document.body.dataset.interfaceDepth="standard"}function Zd(){Gd(),window.spwashi.onModeChange=(t,e=!1)=>{var i,r,o,s,a;t&&window.spwashi.setItem("mode",t,"focal.root"),(i=document.querySelector('[data-mode-action] [aria-selected="true"]'))==null||i.setAttribute("aria-selected","false");const n=document.querySelector(`#mode-selector--${t}`);switch(n&&(n.setAttribute("aria-selected","true"),Oe(),document.body.dataset.interfaceDepth==="main-menu"?Vr(n):et.fx||Ut({x:window.innerWidth*.2,y:window.innerHeight*.75})),Jd(),t){case"spw":const l=document.querySelector("#spw-mode-container");l.tabIndex=0,e&&l.focus();break;case"reflex":Md();break;case"color":Dd();break;case"story":const u=document.querySelector("#story-mode-container").querySelector(".button-container button");u.focus(),u.onfocus=()=>u.tabIndex=0;break;case"node":const f=document.querySelector("#node-input-container");f.tabIndex=0,f.focus(),f.onfocus=()=>f.tabIndex=0;break;case"map":(o=(r=window.spwashi.callbacks).onMapMode)==null||o.call(r);break;case"filter":(a=(s=window.spwashi.callbacks).onFilterMode)==null||a.call(s);break}Qd()},window.spwashi.onDataIndexChange=t=>{}}function th(){Vd(),eh(),Wd(),Zd(),window.spwashi.counter=0,window.spwashi.modeOrder=["reflex","color","map","filter","node","query","debug","story","spw"],window.location.pathname==="/help"&&($i(),window.spwashi.spwEditor.value=window.spwashi.getItem("help","focal.root")||"",K("spw",!1,!0))}function eh(){window.spwashi.__session=window.spwashi.__session||{i:0},window.spwashi.setItem=(t,e,n=null)=>{window.localStorage.setItem(Ai(t,n),JSON.stringify(e||null))},window.spwashi.getItem=(t,e=null)=>{const n=window.localStorage.getItem(Ai(t,e));if(n)return JSON.parse(n||"{}")}}function Ai(t,e=null){return e||(e=window.spwashi.parameterKey),e+"@"+t}const nh={"v0.0.1":{assetPath:"v0.0.1"}};async function ih(t="v0.0.1"){if(!("serviceWorker"in navigator))return;const{assetPath:e}=nh[t];try{const n=await navigator.serviceWorker.register(`/${e}/service-worker.js`);console.log("Service Worker registered with scope:",n.scope)}catch(n){console.log("Service Worker registration failed:",n)}}function lh(){ih(),window.spwashi={},jr(),th(),Qt(new URLSearchParams(window.location.search)),Yd(De.svg),Oe(),xd(),Fd(window.spwashi.initialMode)}export{De as A,Xu as E,vu as M,G as N,Tn as S,lh as a,j as b,Mu as c,Cu as d,rh as e,sh as f,io as g,oh as h,H as i,ah as j,Od as k,Qe as l,Oi as m,An as n,Pu as o,Cr as p,B as q,En as r,K as s,In as t,ch as u,vr as v,Cd as w,pu as x,Xd as y,Gu as z};
//# sourceMappingURL=index-x_8CaSAC.js.map
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}